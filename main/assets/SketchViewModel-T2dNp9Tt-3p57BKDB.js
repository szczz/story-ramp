const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-cGmuW4MT-BkxEn2df.js","./story-BSn8dUZd.js","./main-evhEtFYV.js","./main-C9A24L49.css","./story-Dmm6P95U.css","./globalCss-CFN4F315-DYIQb7lw.js","./Queue-B8H6jIv7-DermpPUZ.js","./signal-DxzURL18-BIml8fr1.js","./Version-BTMwSXf1-BONRzg8I.js","./quantityUtils-RaoZoCNH-D6-sPzO8.js","./vec2-BnynUbeJ-CKtGJQAy.js","./common-CYWrYyJl-E8-sukrT.js","./geodesicLengthMeasurementUtils-X1SKKkBz-BHYF0tix.js","./index-CVKk0WAC-dv5DdI9y.js","./draw-store-C1_quxsr-BZeAFUWU.js","./GraphicsLayer-GkJJfSu5-DzPWwO25.js","./GraphicsCollection-rAFZo1AJ-Bc0t9BxY.js","./Layer-B8q-l4yV-BhNvh7El.js","./TimeExtent-gZaEUVeW-lmURPZs3.js","./ScaleRangeLayer-DIxukUBC-C7_PRh3E.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-DzmXEA9_-C8OJGP_1.js","./parser-hXQyB-Qx-BPRVbg8f.js","./mat4f32-CiZjBg9k-CUm34GoR.js","./mat4-BFStKTjU-CckVUlHi.js","./ElevationInfo-DkWlof50-BTc9ty9m.js","./lengthUtils-wU9RRIqK-CfCyp1oe.js","./intl-DLmy-Li5-DDXPhh_U.js","./jsxFactory-C5LxVioS-CGvUzJGx.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./layerViewUtils-Bk5QNiAa-Bt7QzLfU.js","./widget-BgluoE6k-CZveemS_.js","./diffUtils-BSe9IE26-C0UB3KDP.js","./UpdatingHandles-DBzjq66S-DzzPDZ40.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./vec32-BuqRmYBM-fJ1Go0LA.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./projection-m8vi7Cxv-DabLaeW0.js","./meshVertexSpaceUtils-BwEbYR8F-DrEhZ7-Z.js","./MeshLocalVertexSpace-DFCiKNRA-ByX4RoVJ.js","./hydratedFeatures-BDT5zTGB-FnFE3iun.js","./projectVectorToVector-D0K_S4MR-C72UTjz2.js","./projectPointToVector-CG1hALQu-B2iw0lS4.js","./plane-B_adY3_o-CokMJNDw.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./quatf64-C16JxGFv-BKWK1F8U.js","./geodesicUtils-DV-lFWtb-CC8V699D.js","./Scheduler-Br-2v2ys-BRWpgHYn.js","./geometryEngineBase-DueYg7ux-CCeespPx.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-Bae3cp-4-Spz3nvCH.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./quat-D8L_R4I0-OzMeraP9.js","./drapedUtils-7RfmdK5D-Mq_D3x-D.js","./utils-C0LvbFCo-RMQaTNpt.js","./substitute-TfjvVaWd-Ce43VeFX.js","./Query-CxQYWcUQ-11z6jJGU.js","./Field-Cj6Pz3TI-snRwZE73.js","./fieldType-VTpxE-EM-FRk-VB8i.js","./sphere-Cj20syUS-DFxQs8pO.js","./mat3-DOnW3DjW-C3hbW9XY.js","./GridSnappingEngine-DCXaqXz2-D2icDkDR.js","./normalizeUtils-b-vZURob-KDh3nV9i.js","./utils-DuaeuwP5-uPvwoiIL.js","./utils-Jw-4AGsF-BkSo-_k0.js","./scaleUtils-DtnDbXa5-A-yi5XXk.js","./gridUtils-D2du44-d-BUimRvfS.js","./FeatureSnappingEngine-aDZtmISS-C_6UNnwj.js","./FeatureFilter-C7FajlY_-73kBL55X.js","./floorFilterUtils-4r-vVdzs-C43jLoAE.js","./editingTools-KBOXuhog-Dlng1LhR.js","./SnappingVisualizer2D-DR-yrbjS-CgE5QR89.js","./enums-f9UUstHQ-hLTu4V1l.js","./automaticAreaMeasurementUtils-Bz1iefP0-B3yN_IOB.js","./PointSnappingHint-ClwQ1VNw-BYBcUcMs.js","./automaticLengthMeasurementUtils-BcfJmFU0-GaA-zpd5.js","./MeshTransform-CvTryVbE-CT0sSY5G.js","./axisAngleDegrees-nTnQhoaG-BKqT15kA.js","./themeUtils-RB4IoNvm-uO-dsvgO.js","./a11yUtils-C2ydunC--CvTmJV-1.js","./unitFormatUtils-zTNxheG9-Dr5zq753.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./spatialReferenceEllipsoidUtils-DlQOpWof-DP5ttsCl.js","./earcut-XDcq3zAf-BcwyrT7l.js","./triangle-BePBrXJ8-sKJGInLE.js","./lineSegment-BJNfNZM5-Cq_CP3OB.js","./editPlaneUtils-CYBM1uSC-Dv2srFPK.js","./boundedPlane-B6TkXVHT-nRk2Mtao.js","./cimSymbolUtils-BuFg2oLA-BJOVW6OA.js","./utils-BYqzY6_X-BqsSqIka.js","./defaultCIMValues-gWpu7WSC-cjxb95kj.js","./GraphicManipulator-DXPP3gDs-BdMjqcaS.js","./colorUtils-DxUhbS7D-CKu_u3DP.js","./drawUtils-BUIg7AUj-DaQZmuQi.js","./editingTools-CWx0-1A2-PBrCZS45.js","./glsl-o28TenZV-B0eZUNn3.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./interfaces-D_DB_-WL-GnK18Rhv.js","./VerticalOffset.glsl-BtVaDxLq-BJdqTL10.js","./Indices-DkAzsiH--B5a2XPyy.js","./InterleavedLayout-DcHoXu73-gAshwN4d.js","./BufferView-BBCzkcZS-CBnetIvv.js","./renderState-DlSSrLcZ-Du_EmLq6.js","./enums-DBi1-Mm2-CUS1pvQe.js","./VertexAttribute-DFC3a3eR-BhmQtMsu.js","./ShaderOutput-C_OqLoo1-jp3zUBgm.js","./requestImageUtils-rT_rMd2F-Cj_04cWc.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./Texture-DXSFJsEu-DWK_6IB9.js","./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js","./orientedBoundingBox-CTsjUkMw-BNSgHqc0.js","./computeTranslationToOriginAndRotation-DwwrTl3S-B-NRiStg.js","./ShaderBuilder-BkQM64Qp-B8KbVyjs.js","./triangulationUtils-KRNFVU70-C4boufVo.js","./deduplicate-DZCyc4JG-Ba5zK5kL.js","./RibbonLine.glsl-B9kKeq0l-CMXebr7P.js","./HUDVisibility.glsl-Bl7zdrV0-MU7lhvd7.js","./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js","./vec3f32-BS0cezmI-B_madU1n.js","./Octree-Kk-G5P_T-BYr8m88P.js","./floatRGBA-YJlz5IlR-BqAqHoR4.js","./HUDMaterial.glsl-DUfp5PMk-Dgdk0W9o.js","./VertexArrayObject-DTkLCIKs-DBLROU32.js","./memoryEstimations-iHVpvWPf-DeCWdaPR.js","./HighlightDefaults-Cg50f_1y-DUcgMhSs.js","./VertexElementDescriptor-BAy1DPb3-BOhpDZGx.js","./NestedMap-Ddo7BfvO-BpVPk8mz.js","./TextOverlayItem-pAuO460X-DMt2fv0_.js","./glUtil-n1JOrdV3-CRAZdee5.js","./SelectedVertexTooltipInfo-C6fS9jtg-BX1GwUWn.js","./TranslateTooltipInfo-BmeZ3crn-B6fePdIC.js","./utils-C_9ghOVk-BOG1oEwi.js","./LRUCache-BLmkvs7b-1i_aXPGT.js","./MemCache-BCippCv6-rFeo-JvT.js","./IViewEvents-BE10MM98-CvMfjolG.js","./MD5-CHHr-oed-SuyrCYQ0.js","./multiOriginJSONSupportUtils-DGETddQl-BrWaY9_8.js","./ExtentScaleTooltipInfo-DGVFaJSb-Cl_Q5r7o.js","./LineCallout.glsl-B1CPwb2z-BKivUBAy.js","./heightModelInfoUtils-CI93rfC7-DiMuToDI.js","./HeightModelInfo-BkDck4B0-CbO6BTeV.js","./visualVariableUtils-BO-_wo28-DkJ77ZTV.js","./dehydratedFeatures-CekTKTy7-BSrmXTHi.js","./UniqueValueRenderer-BmoLL_Ee-C2uk3Ho9.js","./commonProperties-BLIn8DYU-ac2WTnri.js","./colorRamps-KMmVdCPJ-CBh82rp6.js","./ColorStop-DoHCvOqO-CroAWps9.js","./RendererLegendOptions-f5mIImtQ-qmKFJXOj.js","./styleUtils-DxAOZq5S-fdZMlbYM.js","./rendererConversion-D-HBj0jy-D_KZoE5T.js","./RealisticTree.glsl-De7nH4tm-CMP5qi1F.js","./DefaultMaterial-DGGIMylx-CTpj_vJK.js","./NormalAttribute.glsl-C9zbIKka-C50c5yz3.js","./edgeUtils-CjV7X0G9-D6TX6-ME.js","./OptimizedFeatureSet-D6mgsKNr-7DlExj8d.js","./OptimizedGeometry-1qDYm3YK-C02QffgX.js","./optimizedFeatureQueryEngineAdapter-Bx4OOJmK-DD06-BpP.js","./vec2f32-CVhmN3Me-DxoqVD7C.js","./featureConversionUtils-DRaHTjrY-BUohY9K-.js","./webStyleAcceptedFormats-DsfCZOwz-CG7ZQ6BV.js","./PooledRBush-J5-OtqBl-BclFTrRH.js","./quickselect-DHTstthl-Ds_Aj0x5.js","./popupUtils-sIuvqRgn-BNdqlbto.js","./geometryServiceUtils-7fDBrM6E-3X__G4VI.js","./project-CdmvlsYz-BwAPzEmp.js","./LayerView-D3XoMhlx-RbcSyOyQ.js","./GraphicMover-CiNX1V2i-DNJJBwFq.js","./featureUtils-CZUu1SmW-DikaebWw.js","./utils-BG7WTOnW-BlpVFoWC.js","./timeZoneUtils-z3WjfjXQ-DZyvXIWU.js","./Box-CcaqKOvu-BB1-ytRz.js","./settings-zzKkZJrb-BImp9Qm-.js","./Reshape-BUYuf7aU-DpkBvzpB.js"])))=>i.map(i=>d[i]);
import{_ as N}from"./main-evhEtFYV.js";import{v as c,cC as v,f_ as ve,d4 as Cn,I as h,aa as Ee,a as zt,b7 as re,ai as _e,H as Pt,K as Dn,eP as Nn,e9 as di,eA as Hn,ez as Un,gE as Vn,gF as Fn,c$ as ui,aA as Be,aC as $n,d9 as Rt,aM as yi,cg as Ui,gG as jn,gg as qn,gH as J,gI as gi,a8 as Vi,c as zn,d6 as fi,dh as Zn,gh as nt,t as C,Y as Fi,cV as ot,ej as Yn,fY as Bn,ac as Wn,gJ as Kn,aE as Ne,dd as Xn,f$ as Jn,d7 as Qn,aj as eo,dq as vi,d$ as ke,gn as to,cm as ft,ah as io,aq as no,c8 as oo,at as ro,cK as so,d2 as ao,gK as po}from"./story-BSn8dUZd.js";import{i as lo}from"./UpdatingHandles-DBzjq66S-DzzPDZ40.js";import{O as Dt,Q as co,L as ho,k as uo,K as yo,i as go}from"./projection-m8vi7Cxv-DabLaeW0.js";import fo from"./GraphicsLayer-GkJJfSu5-DzPWwO25.js";import{b as vo}from"./ElevationInfo-DkWlof50-BTc9ty9m.js";import{g as G,A as mi,k as mo,a as _o,W as Eo,m as bo}from"./globalCss-CFN4F315-DYIQb7lw.js";import{t as Ue,g as Zt}from"./quantityUtils-RaoZoCNH-D6-sPzO8.js";import{i as H,y as ie,l as we,P as Ae,f as wo,b as To,h as $i,M as ji,D as So,v as Oo,k as Po,A as Ro,m as qi,E as _i}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as q,y as Go,t as Qe,l as Ao}from"./vec2f64-CEUyUoff-BBc0aQ6D.js";import{O as k,T as O,p as Nt,C as F,v as Mo,y as V,X as rt,l as xo,r as vt,P as Lo,Y as ko,_ as mt,g as zi,A as ne,W as Io,V as Ht}from"./vec32-BuqRmYBM-fJ1Go0LA.js";import{s as Fe,p as Zi,f as st}from"./projectVectorToVector-D0K_S4MR-C72UTjz2.js";import{u as Ut,D as Yt,W as at,C as Bt}from"./geodesicUtils-DV-lFWtb-CC8V699D.js";import{O as Co}from"./TimeExtent-gZaEUVeW-lmURPZs3.js";import{b as Do}from"./Query-CxQYWcUQ-11z6jJGU.js";import{y as No,w as Ho}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{o as Uo}from"./vec4f64-CjUMzAyX-DPYbdAom.js";import{Q as z,m as Yi,O as Vo,U as Bi,P as Fo,B as _t,$ as Wi,a as Vt,E as Ki,K as $o}from"./plane-B_adY3_o-CokMJNDw.js";import{G as jo,F as qo,B as zo,w as Zo,U as Yo}from"./sphere-Cj20syUS-DFxQs8pO.js";import{n as Ve}from"./common-CYWrYyJl-E8-sukrT.js";function Xi(e){return e?Te:or}function Bo(e,t){return t?.mode?t.mode:Xi(e).mode}function Wo(e,t){return t??Xi(e)}function Ji(e,t){return Bo(e==null||(e.hasZ??!1),t)}function Ys(e,t){return Wo(e==null||(e.hasZ??!1),t)}function Ko(e){const t=Qi(e);return Ji(e.geometry,t)}function Xo(e){const t=Qi(e),i=Ji(e.geometry,t),n=t!=null&&i!=="on-the-ground"?nr(t):0,o=t?.featureExpressionInfo;return{mode:i,offset:n,featureExpressionInfo:o}}function Jo(e){return Et(Xo(e))}function Bs(e){return Et(e)||Qo(e)}function Qo(e){return e?.featureExpressionInfo?.expression==="0"}function Et(e){if(!e||e.mode==="on-the-ground")return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||t==="0")}function Qi(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function Wt(e,t){if(!e?.offset)return 0;const{offset:i,unit:n}=e;if(n==="decimal-degrees")return 0;const o=n!=="unknown"&&n?n:"meters",r=to(t);return r?ft(i,o,r):0}function Ws(e,t,i){if(!i?.mode)return;const n=e.hasZ?e.z:0,o=Wt(i,e.spatialReference);switch(i.mode){case"absolute-height":return n-o;case"on-the-ground":return 0;case"relative-to-ground":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"ground")??0)+o);case"relative-to-scene":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"scene")??0)+o)}}function er(e,t,i,n=null){return Kt(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,n)}function en(e,t,i,n,o=null){return Kt(e,t[0],t[1],t.length>2?t[2]:0,i,n,o)}function Kt(e,t,i,n,o,r,a=null){if(r==null)return;const s=a!=null?a.mode:"absolute-height";if(s==="on-the-ground")return 0;const{absoluteZ:l}=tr(t,i,n,o,e,r);return ir(l,t,i,n,o,e,a,s)}function tr(e,t,i,n,o,r){const a=Wt(r,n);switch(r.mode){case"absolute-height":return{absoluteZ:i+a,elevation:0};case"on-the-ground":{const s=o.elevationProvider.getElevation(e,t,0,n,"ground")??0;return{absoluteZ:s,elevation:s}}case"relative-to-ground":{const s=o.elevationProvider.getElevation(e,t,i,n,"ground")??0;return{absoluteZ:i+s+a,elevation:s}}case"relative-to-scene":{const s=o.elevationProvider.getElevation(e,t,i,n,"scene")??0;return{absoluteZ:i+s+a,elevation:s}}}}function ir(e,t,i,n,o,r,a,s){const l=Wt(a,o);switch(s){case"absolute-height":return e-l;case"relative-to-ground":return e-((r.elevationProvider.getElevation(t,i,n,o,"ground")??0)+l);case"relative-to-scene":return e-((r.elevationProvider.getElevation(t,i,n,o,"scene")??0)+l)}}function Ks(e,t){if(t==null)return!1;const{mode:i}=t;return i!=null&&(e==="scene"&&i==="relative-to-scene"||e==="ground"&&i!=="absolute-height")}function Xs(e,t,i){return i&&i.mode!==t?`${e} only support ${t} elevation mode`:null}function Js(e,t,i){return i?.mode===t?`${e} do not support ${t} elevation mode`:null}function Qs(e,t){return t?.featureExpressionInfo!=null&&t.featureExpressionInfo.expression!=="0"?`${e} do not support featureExpressionInfo`:null}function ea(e,t){t&&e.warn(".elevationInfo=",t)}function nr(e){return(e?.offset??0)*vo(e?.unit)}const Te={mode:"absolute-height",offset:0},or={mode:"on-the-ground",offset:null};function Gt(e,t){return e[0]*t[1]-e[1]*t[0]}function rr(e,t,i){const n=Ae(i,t)/we(i);return Oo(e,i,n)}function ta(e,t,i,n,o=i){return H(be,n,i),H(pt,t,o),rr(Re,pt,be),To(e,o,Re)}function ia(e,t,i,n){H(be,t,i);const o=n/$i(be);return ie(e,i,be,o)}function na(e,t){const i=e.start,n=e.end,o=t.start,r=t.end,a=H(be,n,i),s=H(tn,r,o),l=Gt(a,s);if(Math.abs(l)<=ar)return[];const p=H(pt,i,o),d=Gt(s,p)/l,u=Gt(a,p)/l;if(d>=0){if(u>=0||t.type===P.LINE)return[ie(Re,i,a,d)]}else if(e.type===P.LINE&&(u>=0||t.type===P.LINE))return[ie(Re,i,a,d)];return[]}function sr(e,t,i){const n=[],o=H(be,e.end,e.start),r=H(tn,e.start,t),a=we(o),s=2*Ae(o,r),l=s*s-4*a*(we(r)-i*i);if(l===0){const p=-s/(2*a);(e.type===P.LINE||p>=0)&&n.push(ie(Re,e.start,o,p))}else if(l>0){const p=Math.sqrt(l),d=(-s+p)/(2*a);(e.type===P.LINE||d>=0)&&n.push(ie(Re,e.start,o,d));const u=(-s-p)/(2*a);(e.type===P.LINE||u>=0)&&n.push(ie(pt,e.start,o,u))}return n}var P;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(P||(P={}));const ar=1e-6,be=q(),tn=q(),pt=q(),Re=q();function pr(e,t,i,n,o=v()){const r=mt(lr,e);return r[2]=en(n,r,t,i)||0,n.renderCoordsHelper.toRenderCoords(r,t,o),o}const lr=v(),nn="z",on="r",R={redo:on,undo:nn,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},Ei={toggle:"Control"},oa={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},ra={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:mo,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:nn,redo:on};let sa=class{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,i=>{i.type==="key-down"&&t(i)})}addToggle(e,t){const i=cr.fromDefinition(e,t),n=io(this._bindings,i.key,()=>[]);return n.push(i),no(()=>oo(n,i))}register(e,t=G.WIDGET){return ro([e.on("key-down",i=>this.dispatch(e.inputManager,i),t),e.on("key-up",i=>this.dispatch(e.inputManager,i),t)])}dispatch(e,t){const i=t.key,n=this._bindings.get(i);if(n)for(const o of n)o.process(e,t)}},cr=class Ft{constructor(t,i,n,o,r){this.key=t,this.modifiers=i,this.repeats=n,this.continuePropagation=o,this.callback=r}process(t,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const n of this.modifiers)if(!t.isModifierKeyDown(n))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(t,i){if(typeof t=="string")return new Ft(t,[],!1,!1,i);const{key:n,modifier:o,repeats:r,continuePropagation:a}=t;return new Ft(n,o?Array.isArray(o)?o:[o]:[],!!r,!!a,i)}};var Se;function rn(e,t,i){return j(e,t,i)}function j(e=0,t=0,i=0){return nt(e,t,i)}function aa(e){return e}function pa(e){return e}function me(e,t,i){return nt(e,t,i)}function Ge(e){const[t,i,n]=e;return e.length>3?[t,i,n,e[3]]:[t,i,n]}function At(e){return e[3]=((e.length>3?e[3]:void 0)??Se.NONE)|Se.TARGET,e}function la(e){return!!(((e.length>3?e[3]:void 0)??Se.NONE)&Se.TARGET)}function bi(e,t,{coordinateHelper:i,elevationInfo:n},o){return e?De(i.vectorToDehydratedPoint(e,hr),t,n,o):null}function De(e,t,i,n=j()){return n[0]=e.x,n[1]=e.y,n[2]=e.z??0,t==null||(t.type==="2d"?n[2]=0:n[2]=er(t,e,i,Te)??0),n}function ca(e,t,i){return i?(Zi(i,e[0],e[1],e[2],t),i):Fe(e[0],e[1],e[2],t)}function wi(e,t,{z:i,m:n},o,r){const{spatialReference:a,elevationInfo:s}=o;let l;i==null&&n==null?l=void 0:t==null||t.type==="2d"?l=i??void 0:l=en(t,e,a,Te,s)??0;const[p,d]=e;return r?Zi(r,p,d,l,a):r=Fe(p,d,l,a),n!=null&&(r.m=n,r.hasM=!0),r}function ha(e,t,i,n,o=j()){const[r,a]=e;return o[0]=r,o[1]=a,e.length>3&&(o[3]=e[3]??Se.NONE),i?.type!=="3d"?(o[2]=t.value,o):(o[2]=Kt(i,r,a,t.value,n,t.elevationInfo,Te)??0,o)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(Se||(Se={}));const hr=Fe(0,0,0,null);let K=class extends Fi{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],K.prototype,"enabled",void 0),K=c([C("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],K);let S=class extends Fi{constructor(e){super(e),this.lineSnapper=new K,this.parallelLineSnapper=new K,this.rightAngleSnapper=new K,this.rightAngleTriangleSnapper=new K,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new ot([255,127,0]),this.orangeTransparent=new ot([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:ot,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:ot,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([C("esri.views.interactive.snapping.Settings.Defaults")],S);const lt=new S;var I;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(I||(I={}));let bt=class{constructor(e,t){this.isDraped=e,this.domain=t}},dr=class sn extends bt{constructor(t,i,n=I.ALL){super(i,n),this.intersectionPoint=t}equals(t){return t instanceof sn&&O(this.intersectionPoint,t.intersectionPoint)}},oe=class an extends bt{constructor(t,i,n,o,r=I.ALL,a=!0,s=!0){super(o,r),this.type=t,this.lineStart=i,this.lineEnd=n,this.fadeLeft=a,this.fadeRight=s}equals(t){return t instanceof an&&this.type===t.type&&O(this.lineStart,t.lineStart)&&O(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return zi(this.lineStart,this.lineEnd)}},ur=class pn extends bt{constructor(t,i,n,o=I.ALL){super(n,o),this.lineStart=t,this.lineEnd=i}equals(t){return t instanceof pn&&O(this.lineStart,t.lineStart)&&O(this.lineEnd,t.lineEnd)}},ln=class cn extends bt{constructor(t,i,n,o,r=I.ALL){super(o,r),this.previousVertex=t,this.centerVertex=i,this.nextVertex=n}equals(t){return t instanceof cn&&O(this.previousVertex,t.previousVertex)&&O(this.centerVertex,t.centerVertex)&&O(this.nextVertex,t.nextVertex)}};function Xt({start:e,end:t,type:i},n,o){const r=[],a=H($e,t,e),s=H(wt,e,n),l=we(a),p=2*Ae(a,s),d=p*p-4*l*(we(s)-o*o);if(d===0){const u=-p/(2*l);(i===$.PLANE||u>=0)&&r.push(ie(q(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-p+u)/(2*l);(i===$.PLANE||f>=0)&&r.push(ie(q(),e,a,f));const y=(-p-u)/(2*l);(i===$.PLANE||y>=0)&&r.push(ie(q(),e,a,y))}return r}function hn(e,t){const i=e.start,n=e.end,o=H($e,n,i),r=ne(St,-o[1],o[0],0),a=t.start,s=t.end,l=F(Qt,s,a),p=V(l,r),d=ne(_n,i[0],i[1],0),u=F(En,d,a),f=V(u,r),y=Ve();if(Math.abs(p)<y)return[];const g=k(bn,a,l,f/p);if(t.type===P.RAY){const _=F($t,g,a);if(V(_,l)<-y)return[]}if(e.type===$.HALF_PLANE){const _=Po(wt,g,i);if(Ae(_,o)<-y)return[]}return[ve(g)]}function yr(e,t){return fr(ct(ei,t[2],e),t)}function dn(e,t){return vn(ct(ei,0,e),ct(Er,0,t)).map(([i,n])=>Qe(i,n))}function un(e,t,i){return gn(e,ct(ei,e[2],t),i)}function yn(e,t,i,n=v()){const o=H($e,e,t),r=$i(o);return ie(n,t,o,r===0?1:i/r),n[2]=e[2],n}function gn(e,{start:t,end:i,type:n},o=v()){const r=F(Tt,e,t),a=F(St,i,t),s=V(r,a)/V(a,a);return k(o,t,a,n===P.RAY?Math.max(s,0):s)}const gr=(()=>{const e=v(),t=v(),i=v();return({start:n,end:o},{center:r,radius:a,normal:s,slicePlane:l})=>{const p=_t(r,s,_r);if(w(Vt(p,n),0)&&w(Vt(p,o),0)){Wi(s,e,t);const u=(g,_)=>(vt(i,_,r),qi(g,V(i,e),V(i,t)),g),f=sr({start:u($e,n),end:u(wt,o),type:P.LINE},Ao,a),y=[];for(const[g,_]of f){const T=mt(v(),r);k(T,T,e,g),k(T,T,t,_),l&&!fe(l,T)||y.push(T)}return y}const d=v();return Yi(p,n,o,d)?!w(zi(d,r),a)||l&&!fe(l,d)?[]:[d]:[]}})();function fn({start:e,end:t,type:i},n,o){const r=[],a=vt(Tt,t,e),s=H(wt,e,n),l=we(a),p=2*Ae(a,s),d=p*p-4*l*(we(s)-o*o);if(d===0){const u=-p/(2*l);(i===P.LINE||u>=0)&&r.push(k(v(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-p+u)/(2*l);(i===P.LINE||f>=0)&&r.push(k(v(),e,a,f));const y=(-p-u)/(2*l);(i===P.LINE||y>=0)&&r.push(k(v(),e,a,y))}return r}function vn(e,t){const i=e.start,n=e.end,o=t.start,r=t.end,a=F(Tt,n,i),s=F(St,r,o),l=F(Qt,o,i),p=rt(_n,a,s);if(!w(V(l,p),0))return[];const d=Ht(p);if(w(d,0))return[];const u=rt(En,l,s),f=V(u,p)/d,y=k(bn,i,a,f);if(e.type===P.RAY){const g=F($t,y,i);if(V(a,g)<-Ve())return[]}if(t.type===P.RAY){const g=F($t,y,o);if(V(s,g)<-Ve())return[]}return[ve(y)]}function fr({start:e,end:t,type:i},n){const o=F(Tt,n,e),r=F(St,t,e),a=rt(Qt,r,o),s=Ht(a)/Ht(r),l=Ve();if(s<l)switch(i){case P.LINE:return[ve(n)];case P.RAY:return V(r,o)<-l?[]:[ve(n)]}return[]}function Jt(e,t,i,n){const[o,r]=e,[a,s]=i,l=a-o,p=s-r,d=l*l+p*p,u=Math.sqrt(d);if(u>t+n)return[];if(u<Math.abs(t-n))return[];if(w(u,0)&&w(t,n))return[];const f=(t*t-n*n+d)/(2*u),y=Math.sqrt(t*t-f*f),g=y*p/u,_=y*l/u,[T,E]=Ro($e,e,i,f/u);return w(g,_)?[Qe(T,E)]:[Qe(T+g,E-_),Qe(T-g,E+_)]}function ct(e,t,{start:i,end:n,type:o}){return ne(e.start,i[0],i[1],t),ne(e.end,n[0],n[1],t),e.type=mr[o],e}function mn(e,t){return w(e[2],t[2])}function w(e,t){return Yn(Math.abs(e-t),0,Ve())}function vr(e,t){return t.filter(i=>fe(e,i))}function fe(e,t){return Fo(e,t)}var $;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})($||($={}));const mr={[$.PLANE]:P.LINE,[$.HALF_PLANE]:P.RAY},$e=q(),wt=q(),Tt=v(),St=v(),Qt=v(),_n=v(),En=v(),bn=v(),$t=v(),_r=z(),ei={start:v(),end:v(),type:P.LINE},Er={start:v(),end:v(),type:P.LINE};class Y{intersect(t){return se(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Me extends Y{constructor(t){super(),this.point=t}equals(t){return this===t||B(t)&&O(this.point,t.point)}closestTo(){return Ge(this.point)}}class ti extends Y{constructor(t,i,n){super(),this.start=t,this.end=i,this.lineLike={start:t,end:i,type:n}}equals(t){return this===t||Q(t)&&this.lineLike.type===t.lineLike.type&&O(this.start,t.start)&&O(this.end,t.end)}closestTo(t){const i=j();return gn(t,this.lineLike,i),i}}class ii extends ti{constructor(t,i){super(t,i,P.LINE)}}class br extends ti{constructor(t,i){super(t,i,P.RAY)}}class wn extends Y{constructor(t){super(),this.constraints=t}equals(t){return this===t||jt(t)&&Bn(this.constraints,t.constraints,(i,n)=>i.equals(n))}closestTo(t){let i,n=1/0;for(const o of this.constraints){const r=o.closestTo(t),a=Nt(t,r);a<n&&(n=a,i=r)}return Ge(i??t)}closestPoints(t){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(t))}}class Tn extends Y{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||te(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const i=j();return yn(t,this.center,this.radius,i),i}}class ni extends Y{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||pe(t)&&O(this.center,t.center)&&this.radius===t.radius}closestTo(t){const i=j();return yn(t,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new oi(Ge(this.center),this.radius,me(0,0,1))}}class oi extends Y{constructor(t,i,n,o=void 0){super(),this.center=t,this.radius=i,this.normal=n,this.slicePlane=o}equals(t){return this===t||ue(t)&&O(this.center,t.center)&&O(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:i,radius:n}=this;Bi(this.getPlane(wr),t,Mt);const o=F(Mt,Mt,i),r=Mo(o);if(w(r,0))return Ge(t);const a=n/Math.sqrt(r),s=j();k(s,i,o,a);const{slicePlane:l}=this;return l&&!fe(l,s)?si(l,this)?.closestTo(t)??Ge(t):s}getPlane(t=z()){return _t(this.center,this.normal,t)}}const Mt=v(),wr=z();class Tr extends Y{constructor(t){super(),this.z=t}equals(t){return this===t||ae(t)&&this.z===t.z}closestTo(t){return me(t[0],t[1],this.z)}getPlane(t=z()){return ne(Ti,0,0,this.z),_t(Ti,po,t)}}const Ti=v();class ri extends Y{constructor(t,i,n){super(),this.start=t,this.end=i,this.planeLike={start:t,end:i,type:n}}equals(t){return this===t||ee(t)&&this.planeLike.type===t.planeLike.type&&O(this.start,t.start)&&O(this.end,t.end)}closestTo(t){const i=j();return un(t,this.planeLike,i),i}closestEndTo(t){const{start:i,end:n}=this.planeLike;return Math.sign(Ae(H(Sr,n,i),H(Or,t,i)))>0?this.end:this.start}getPlane(t=z()){const i=mt(Si,this.end);return i[2]+=1,$o(this.start,this.end,i,t)}getSlicePlane(t=z()){const{start:i,end:n,type:o}=this.planeLike;if(o===$.PLANE)return;const r=ne(Si,i[0],i[1],0),a=ne(Oi,n[0],n[1],0),s=vt(Oi,a,r);return _t(r,s,t),t}}const Sr=q(),Or=q(),Si=v(),Oi=v();class da extends ri{constructor(t,i){super(t,i,$.HALF_PLANE)}}class Sn extends ri{constructor(t,i){super(t,i,$.PLANE)}}class Pr extends Y{constructor(t,i){super(),this.sphere=qo(t,i)}equals(t){return this===t||le(t)&&zo(this.sphere,t.sphere)}closestTo(t){const i=j();return Zo(this.sphere,t,i),i}get center(){return Yo(this.sphere)}get radius(){return this.sphere[3]}}class On extends Y{constructor(t,i,n){super(),this.start=t,this.end=i,this.getZ=n,this.planeLike={start:t,end:i,type:$.PLANE}}equals(t){return this===t||ht(t)&&O(this.start,t.start)&&O(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Lr(this,t)}addIfOnTheGround(t,i){for(const n of i){const o=this.getZ(n[0],n[1])??0;w(n[2],o)&&(n[2]=o,t.push(n))}}}class Rr extends Y{constructor(t,i,n){super(),this._x=t,this._y=i,this._z=n}equals(t){return this===t||Br(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,i,n]){return rn(this._x??t,this._y??i,this._z??n)}}class Gr extends Y{constructor(t,i,n,o,r){super(),this._origin=t,this._spatialReference=i,this._distanceMeters=n,this._z=o,this._directionDegrees=r}equals(t){return this===t||Yr(t)&&_i(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,i,n]){return qi(Ie,t,i),_i(Ie,this._origin)||this._applyDirectionAndDistance(Ie),rn(Ie[0],Ie[1],this._z??n)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)at(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Mr(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Yt(Ar,this._origin,t,this._spatialReference);at(t,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Ie=[0,0],Ar=new Bt;function Mr(e,t,i,n,o){let{azimuth:r,distance:a}=Yt(xr,t,n,o);r??=0;let s=a*Math.cos((r-i)*go);s=Math.max(0,s),at(e,t,i,s,o)}const xr=new Bt;function Lr(e,t){const i=j();return un(t,e.planeLike,i),i[2]=e.getZ(i[0],i[1])??Rn,i}function se(e,t){if(jt(e)){const i=[];for(const n of e.constraints){const o=n.intersect(t);o&&i.push(o)}return ai(i)}if(jt(t))return se(t,e);if(ht(e))return Pi(e,t);if(ht(t))return Pi(t,e);if(B(e)){const{point:i}=e;if(B(t))return O(i,t.point)?e:void 0;const n=t.closestTo(i);return Io(n,i)?e:void 0}if(Q(e)){if(B(t))return se(t,e);if(Q(t))return X(vn(e.lineLike,t.lineLike));if(ae(t))return kr(e,t);if(ee(t))return X(hn(t.planeLike,e.lineLike));if(te(t))return X(fn(e.lineLike,t.center,t.radius));if(ue(t))return X(gr(e.lineLike,t));if(pe(t))return Ir(e,t);if(le(t))return Cr(e,t)}else if(ae(e)){if(B(t)||Q(t))return se(t,e);if(ae(t))return Dr(e,t);if(ee(t))return Nr(e,t);if(te(t))return Hr(e,t);if(ue(t))return Vr(e,t);if(pe(t))return Ur(e,t);if(le(t))return Fr(e,t)}else if(ee(e)){if(B(t)||Q(t)||ae(t))return se(t,e);if(ee(t))return xt(dn(e.planeLike,t.planeLike));if(te(t))return xt(Xt(e.planeLike,t.center,t.radius));if(ue(t))return jr(e,t);if(pe(t))return $r(e,t);if(le(t))return qr(e,t)}else if(te(e)){if(B(t)||Q(t)||ae(t)||ee(t))return se(t,e);if(te(t))return xt(Jt(e.center,e.radius,t.center,t.radius));if(ue(t))return;if(pe(t))return zr(e,t);if(le(t))return}else if(ue(e)){if(B(t)||Q(t)||ae(t)||ee(t)||te(t))return se(t,e);if(ue(t))return;if(pe(t))return t.asCircle(),void 0;if(le(t))return}else if(pe(e)){if(B(t)||Q(t)||ae(t)||ee(t)||te(t)||ue(t))return se(t,e);if(pe(t))return Zr(t,e);if(le(t))return}else if(le(e)){if(B(t)||Q(t)||ae(t)||ee(t)||te(t)||pe(t))return se(t,e);if(le(t))return}}const kr=(()=>{const e=z();return(t,i)=>{const{start:n,end:o}=t;if(mn(n,o)&&w(n[2],i.z))return t;const r=j();return Yi(i.getPlane(e),n,o,r)?new Me(r):void 0}})();function Ir({lineLike:e},{center:t,radius:i}){const n=t[2];return X(fn(e,t,i).filter(o=>w(o[2],n)))}function Cr({lineLike:e},{sphere:t}){return X(jo(t,e.start,e.end))}const si=(()=>{const e=Uo(),t=v(),i=v();return(n,o,r)=>{const{normal:a,center:s,radius:l}=o;Wi(a,t,i);const p=Ki(n),d=l*V(p,t),u=l*V(p,i);No(e,s[0],s[1],s[2],1);const f=Ho(n,e),y=Math.hypot(d,u),g=w(y,0);if(w(Vt(n,s),0)){if(g)return o;if(w(l,0))return!r||fe(r,s)?new Me(Ge(s)):void 0;rt(t,p,a),xo(t,t);const Ot=new Array,Ze=ve(s);k(Ze,Ze,t,l),r&&!fe(r,Ze)||Ot.push(Ze);const Ye=ve(s);return k(Ye,Ye,t,-l),r&&!fe(r,Ye)||Ot.push(Ye),X(Ot)}if(g)return;const _=-f/y;if(Math.abs(_)>1||w(_,1))return;const T=Math.atan(d/u),E=so(_)-T,Le=Math.PI-E,je=new Array,qe=v();k(qe,s,t,l*Math.cos(E)),k(qe,qe,i,l*Math.sin(E)),je.push(qe);const ze=v();return k(ze,s,t,l*Math.cos(Le)),k(ze,ze,i,l*Math.sin(Le)),je.push(ze),X(r?vr(r,je):je)}})();function Dr(e,t){return w(e.z,t.z)?e:void 0}function Nr({z:e},{planeLike:t}){const[i,n]=t.start,[o,r]=t.end,a=me(i,n,e),s=me(o,r,e);return t.type===$.PLANE?new ii(a,s):new br(a,s)}function Hr(e,t){const[i,n]=t.center;return new ni(me(i,n,e.z),t.radius)}function Ur(e,t){return w(t.center[2],e.z)?t:void 0}const Vr=(()=>{const e=z();return(t,i)=>si(t.getPlane(e),i,i.slicePlane)})();function Fr(e,{center:t,radius:i}){const n=Math.abs(t[2]-e.z);if(n>i&&!w(n,i))return;const o=me(t[0],t[1],e.z),r=Math.sqrt(i**2-n**2);return w(r,0)?void 0:new ni(o,r)}const $r=(()=>{const e=z();return(t,{center:i,radius:n})=>{const o=Xt(t.planeLike,i,n),r=i[2];t.getSlicePlane(e);const a=new Array;for(const[s,l]of o){const p=[s,l,r];fe(e,p)&&a.push(p)}return X(a)}})(),jr=(()=>{const e=z(),t=z();return(i,n)=>si(i.getPlane(e),n,i.getSlicePlane(t))})(),qr=(()=>{const e=z();return(t,{center:i,radius:n})=>{const o=t.getPlane(e),r=Vo(o,i),a=Math.abs(r);if(a>n&&!w(a,n))return;const s=Math.sqrt(n**2-r**2);if(w(s,0)){const d=j();return Bi(o,i,d),new Me(d)}const l=j(),p=ve(Ki(o));return k(l,i,p,r),new oi(l,s,p,t.getSlicePlane())}})();function zr(e,t){const i=ji(e.center,t.center);return w(i,0)&&w(e.radius,t.radius)?t:Pn(Jt(e.center,e.radius,t.center,t.radius),t.center[2])}function Zr(e,t){if(!mn(e.center,t.center))return;const i=ji(e.center,t.center);return w(i,0)&&w(e.radius,t.radius)?e:Pn(Jt(e.center,e.radius,t.center,t.radius),e.center[2])}function Pi(e,t){const{planeLike:i,getZ:n}=e,o=new Array;if(B(t))e.addIfOnTheGround(o,yr(i,t.point));else if(Q(t))e.addIfOnTheGround(o,hn(i,t.lineLike));else if(te(t))for(const[r,a]of Xt(i,t.center,t.radius)){const s=n(r,a);s!=null&&o.push(nt(r,a,s))}else if(ee(t)||ht(t))for(const[r,a]of dn(i,t.planeLike)){const s=n(r,a)??Rn;o.push(nt(r,a,s))}return X(o)}function xt(e){return ai(e.map(([t,i])=>{const n=me(t,i,0),o=me(t,i,1);return new ii(n,o)}))}function X(e){return ai(e.map(t=>t?new Me(t):void 0))}function Pn(e,t){return X(e.map(([i,n])=>[i,n,t]))}function ai(e){if(e.length!==0)return e.length===1?e[0]??void 0:new wn(e.filter(Cn))}function jt(e){return e instanceof wn}function B(e){return e instanceof Me}function Q(e){return e instanceof ti}function ae(e){return e instanceof Tr}function ee(e){return e instanceof ri}function te(e){return e instanceof Tn}function pe(e){return e instanceof ni}function ue(e){return e instanceof oi}function le(e){return e instanceof Pr}function ht(e){return e instanceof On}function Yr(e){return e instanceof Gr}function Br(e){return e instanceof Rr}const Rn=0;var U;function Wr(e,t){if(e==null||t==null)return;const i=qt(e,t);return i!=null?Ue(i,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(U||(U={}));const qt=(()=>{const e=v(),t=v();return(i,n)=>(ne(e,i.x,i.y,i.z??0),ne(t,n.x,n.y,n.z??0),Kr(e,t,i.spatialReference,n.spatialReference))})(),Kr=(()=>{const e=q(),t=v(),i=v();return(n,o,r,a)=>{if(O(n,o))return;const s=Ut(r),l=Ut(a);if(s&&l&&Ui(s,l)&&st(n,r,t,s)&&st(o,a,i,l)){const{azimuth:d}=Yt(Jr,t,i,s);return d!=null?ft(d,"degrees","radians"):void 0}e[0]=o[0]-n[0],e[1]=o[1]-n[1];let p=So(Go,e);return e[0]<0&&(p=Qr-p),p}})();function ua(e,t,i,n=U.Absolute){if(t&&i)switch(n){case U.Absolute:return Wr(t,i);case U.Relative:return Gi(Ri(e,t,i),U.Relative);case U.RelativeBilateral:return Gi(Ri(e,t,i),U.RelativeBilateral)}}function Ri(e,t,i){if(!e||!t||!i)return;const n=qt(e,t),o=qt(t,i);return n!=null&&o!=null?Ue(o-n,"radians","geographic"):void 0}function Gi(e,t){if(e!=null)switch(t){case U.Absolute:return Xr(e);case U.Relative:{const i=dt(e);let n=Ai.normalize(i,0,!0);return n===-180&&(n=180),Ue(n,"degrees","geographic")}case U.RelativeBilateral:{const i=dt(e),n=Math.abs(Ai.normalize(i,0,!0));return Ue(n,"degrees","geographic")}}}function Xr(e){const t=dt(e),i=es.normalize(t,0,!0);return Ue(i,"degrees","geographic")}const ya=(()=>{const e=v();return(t,i,n,o,r,a="geodesic")=>{mt(e,i);const s=dt(r);if(a==="geodesic"){const y=Ut(n);if(y&&st(e,n,e,y))return at(t,e,s,o,y),t[2]=i[2],!!st(t,y,t,n)}const l=Zt(s,"geographic","arithmetic"),p=ft(l,"degrees","radians"),d=i[0]+o*Math.cos(p),u=i[1]+o*Math.sin(p),f=i[2];return ne(t,d,u,f),!0}})();function dt(e){if(e!=null)return Zt(Gn(e),e.rotationType,"geographic")}function ga(e){if(e!=null)return Zt(Gn(e),e.rotationType,"arithmetic")}function Gn(e){return ft(e.value,e.unit,"degrees")}const Jr=new Bt,Qr=2*Math.PI,es=Eo,Ai=new bo(-180,180);let et=class extends re{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],et.prototype,"enabled",void 0),et=c([C("esri.views.interactive.sketch.SketchLabelOptions")],et);const pi=et,fa=Symbol("grid-placement-graphic");function An(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function va(e,t){return Math.sqrt(An(e,t))}function ts(e,t){t.sort((i,n)=>Nt(i.targetPoint,e)-Nt(n.targetPoint,e))}var Z;function ma({point:e,distance:t,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:o},filter:r},a,s){return s=s!=null?s.clone():new Do({where:"1=1"}),r&&(s.geometry=r.geometry,s.distance=r.distance,s.spatialRelationship=r.spatialRelationship,s.where=Wn(s.where,r.where),s.timeExtent=Co(s.timeExtent,r.timeExtent),s.objectIds=is(s.objectIds,r.objectIds)),{point:Fe(e[0],e[1],e[2],o.toJSON()),mode:a,distance:t,returnEdge:i,vertexMode:n,query:s.toJSON()}}function is(e,t){return e||t?t?e?Array.from(Kn(new Set(e),new Set(t))):t:e:null}function _a(e,t,i){return{left:bi(e.leftVertex.pos,t,i),right:bi(e.rightVertex.pos,t,i)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Z||(Z={}));const Mi=Symbol("snapping-toggle");function ns(e,t=()=>{}){const i=_e(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:n,snappingOptions:o})=>{if(e.removeHandles(Mi),!n||!o)return;const r=G.TOOL,a=[n.on("key-down",s=>{s.key!==Ei.toggle||s.repeat||(o.enabledToggled=!0,t())},r),n.on("key-up",s=>{s.key===Ei.toggle&&(o.enabledToggled=!1,t())},r),n.on("pointer-move",s=>{const l=s.native.ctrlKey;o.enabledToggled!==l&&(o.enabledToggled=l,t())},r)];e.addHandles(a,Mi)},Ne);e.addHandles(i)}function Ea(e){return _o(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}let He=class extends re{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],He.prototype,"mode",void 0),He=c([C("esri.views.interactive.sketch.SketchTooltipElevationOptions")],He);let L=class extends re{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],L.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"totalLength",void 0),L=c([C("esri.views.interactive.sketch.SketchTooltipVisibleElements")],L);const Mn=L;let D=class extends re{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new He,this.placement="auto",this.offset=null,this.visibleElements=new Mn,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],D.prototype,"enabled",void 0),c([h()],D.prototype,"forceEnabled",void 0),c([h()],D.prototype,"effectiveEnabled",null),c([h()],D.prototype,"helpMessage",void 0),c([h()],D.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],D.prototype,"inputEnabled",void 0),c([h({type:He,nonNullable:!0})],D.prototype,"elevation",void 0),c([h()],D.prototype,"placement",void 0),c([h()],D.prototype,"offset",void 0),c([h({type:Mn,nonNullable:!0})],D.prototype,"visibleElements",void 0),c([h()],D.prototype,"visualVariables",void 0),c([h()],D.prototype,"xyMode",void 0),D=c([C("esri.views.interactive.sketch.SketchTooltipOptions")],D);const li=D;let Oe=class extends re{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Oe.prototype,"length",void 0),c([h()],Oe.prototype,"verticalLength",void 0),c([h()],Oe.prototype,"area",void 0),Oe=c([C("esri.views.interactive.sketch.Units")],Oe);const ut=Oe;let ye=class extends re{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?U.RelativeBilateral:U.Relative;case"absolute":return U.Absolute}}get displayUnits(){return this._get("displayUnits")??new ut}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new ut}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],ye.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],ye.prototype,"relativeDirectionIsBilateral",void 0),c([h()],ye.prototype,"effectiveDirectionMode",null),c([h({type:ut,nonNullable:!0})],ye.prototype,"displayUnits",null),c([h({type:ut,nonNullable:!0})],ye.prototype,"inputUnits",null),ye=c([C("esri.views.interactive.sketch.SketchValueOptions")],ye);const ci=ye;let ge=class extends re{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Ee}};c([h({constructOnly:!0})],ge.prototype,"layer",void 0),c([h()],ge.prototype,"enabled",void 0),c([h()],ge.prototype,"updating",void 0),c([h()],ge.prototype,"availability",void 0),c([h()],ge.prototype,"sublayerSources",void 0),ge=c([C("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ge);const xn=ge;let M=class extends re{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Ee,this.distance=lt.distance,this.touchSensitivityMultiplier=lt.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(xi)&&Vi.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(rs),i=this._get("_effectiveFeatureSources")?.filter(xi)??new Ee;for(const s of t){const l=i.find(p=>p.layer===s.layer.parent);if(l)l.sublayerSources.includes(s)||l.sublayerSources.add(s);else if(s.layer.parent){const p=new xn({layer:s.layer.parent});p.sublayerSources.add(s),i.add(p)}}for(const s of i){const l=s.sublayerSources.filter(p=>!t.includes(p));s.sublayerSources.removeMany(l)}i.removeMany(i.filter(s=>s.sublayerSources.length===0));const n=e.filter(os),o=this._get("_effectiveFeatureSources")??new Ee,{added:r,removed:a}=ao(o.toArray(),[...n,...i]);return o.removeMany(a),o.addMany(r),o}};c([h()],M.prototype,"enabled",void 0),c([h()],M.prototype,"enabledToggled",void 0),c([h()],M.prototype,"forceDisabled",void 0),c([h()],M.prototype,"selfEnabled",void 0),c([h()],M.prototype,"featureEnabled",void 0),c([h()],M.prototype,"gridEnabled",void 0),c([h()],M.prototype,"attributeRulesEnabled",void 0),c([h({type:Ee.ofType(xn)})],M.prototype,"featureSources",void 0),c([h()],M.prototype,"distance",void 0),c([h()],M.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],M.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],M.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],M.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],M.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],M.prototype,"_effectiveFeatureSources",null),M=c([C("esri.views.interactive.snapping.SnappingOptions")],M);const hi=M;function xi(e){return e.layer.type==="subtype-group"}function os(e){return e.layer.type!=="subtype-group"}function rs(e){return e.layer.type==="subtype-sublayer"}function ss(e){return e?.type==="graphic"}function as(e){return e.find(ss)??null}class xe{constructor(t,i,n,o){this.targetPoint=t,this.constraint=i,this.isDraped=n,this.domain=o}}let Ln=class extends xe{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:n}){super(e,i,n,I.FEATURE),this.objectId=t}},ps=class extends Ln{constructor(e){super({...e,isDraped:!0,constraint:new On(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new oe(Z.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ls=class extends Ln{constructor(e){super({...e,constraint:new ii(e.edgeStart,e.edgeEnd)})}get hints(){return[new oe(Z.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},tt=class extends xe{constructor(e,t,i,n){super(e,new Me(e),n,I.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new dr(this.targetPoint,this.isDraped,this.domain)]}},cs=class extends xe{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:n}){super(i,new Sn(e,t),n,I.SELF),this._referenceLineHint=new oe(Z.REFERENCE_EXTENSION,e,t,n,this.domain)}get hints(){return[this._referenceLineHint,new oe(Z.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},hs=class extends xe{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:n}){const o=ve(t),{left:r,right:a}=e;vt(o,Lo(o,o,a),r),super(i,new Sn(t,o),n,I.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new oe(Z.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new ur(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new oe(Z.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{O(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),O(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),O(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),O(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},ds=class extends xe{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:n,otherVertexType:o,isDraped:r,selfSnappingType:a,objectId:s,domain:l}){super(e,t,r,l??I.SELF),this.previousVertex=i,this.otherVertex=n,this.otherVertexType=o,this.selfSnappingType=a??gt.None,this.objectId=s??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===yt.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===yt.CENTER?this.targetPoint:this.otherVertex;return[new oe(Z.TARGET,t,i,this.isDraped,this.domain),new oe(Z.REFERENCE,e,t,this.isDraped,this.domain),new ln(this.previousVertex,t,i,this.isDraped,this.domain)]}};var yt,gt;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(yt||(yt={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(gt||(gt={}));class us extends xe{constructor({targetPoint:t,point1:i,point2:n,isDraped:o}){super(t,new Tn(ko(v(),i,n,.5),.5*wo(i,n)),o,I.SELF),this._p1=i,this._p2=n}get hints(){return[new oe(Z.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new oe(Z.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new ln(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}function ys(e,t,i,n){return n.type==="2d"?(We.x=e[0],We.y=e[1],We.spatialReference=t,n.toScreen(We)):(pr(e,t,i,n,Li),n.state.camera.projectToScreen(Li,Lt),Xn(Lt[0],Lt[1]))}const We=Fe(0,0,0,null),Li=v(),Lt=Jn();let W=class extends zt.EventedMixin(re){constructor(e){super(e),this.options=new hi,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ce.MAIN}initialize(){this.addHandles([_e(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:n,effectiveGridEnabled:o}=this.options;return{selfEnabled:i,featureEnabled:n,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Qn(i=>this._updateEngines(e,t,i))},Ne),_e(()=>this.options,e=>{for(const t of this._engines)t.options=e},eo)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const n=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!n.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!n.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!n.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const r of o)r.status==="fulfilled"&&r.value?.engine.destroy();else{for(const r of o)r.status==="fulfilled"&&r.value&&n.set(r.value.type,r.value.engine);this._engines=Array.from(n.values())}}async _createSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await N(()=>import("./SelfSnappingEngine-cGmuW4MT-BkxEn2df.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63]),import.meta.url);return Pt(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:i}=await N(()=>import("./GridSnappingEngine-DCXaqXz2-D2icDkDR.js"),__vite__mapDeps([64,1,2,3,4,36,11,39,65,66,67,68,69,49,33,15,16,17,18,19,20,21,22,23,24,25,26,5,6,7,8,9,10,35,43,44,59,60,61,37,38,45,46,47,48,62,63]),import.meta.url);return Pt(e),{type:"grid",engine:new i({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await N(()=>import("./FeatureSnappingEngine-aDZtmISS-C_6UNnwj.js"),__vite__mapDeps([70,2,3,1,4,10,11,36,33,71,59,60,61,18,72,30,39,15,16,17,19,20,21,22,23,24,25,26,5,6,7,8,9,35,43,44,49,37,38,45,46,47,48,62,63]),import.meta.url);Pt(e);const{view:i,options:n}=this,{spatialReference:o}=i;return{type:"feature",engine:new t({view:i,options:n,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return vs(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:r}=i,a=Dt(o,r);if(a==null)return t;const{view:s}=this,{elevationInfo:l,visualizer:p}=i,d=[],u=De(a,s,l),f=n.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,f,i)||!It(n,i.drawConstraints))return this._resetSnappingState(),t;n.targetPoint=At(f),d.push(...n.hints);for(const y of this._currentOtherActiveCandidates)It(y,i.drawConstraints)&&(y.targetPoint=At(f),d.push(...y.hints));return p!=null&&this.addHandles(p.draw(d,{spatialReference:r,elevationInfo:ms(i),view:s,selfSnappingZ:i.selfSnappingZ}),kt),wi(f,s,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case ce.MAIN:return e;case ce.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ce.MAIN}_removeVisualization(){this.removeHandles(kt)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:n}=this,{elevationInfo:o}=t,r=De(e,n,o),a=await this._fetchCandidates(r,I.ALL,t,i);return this._createSnapResult(r,ce.MAIN,a,n,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:n}){const{view:o}=this,{coordinateHelper:r,elevationInfo:a,spatialReference:s}=i;await co(t.spatialReference,s);const l=Dt(t,s),p=De(l,o,a),d=await this._fetchCandidates(p,I.FEATURE,i,n);if(d.length>0){const y=await this._fetchCandidates(p,I.SELF,i,n);return this._createSnapResult(p,ce.SCENE,[...d,...y],o,l,i,n)}const u=De(e,o,a),f=await this._fetchCandidates(u,I.SELF,i,n);return this._createSnapResult(u,ce.MAIN,f,o,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},i,n)}async _fetchCandidates(e,t,i,n){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,i,n)))).flat()}_createSnapResult(e,t,i,n,o,r,a){return{get valid(){return!Dn(a)},apply:()=>{const{spatialReference:s}=r,{snappedPoint:l,hints:p}=this._processCandidates(e,t,i,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(p,{spatialReference:s,elevationInfo:Te,view:n,selfSnappingZ:r.selfSnappingZ}),kt),wi(l,n,o,r)}}}_processCandidates(e,t,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),ts(e,i);const o=this._currentMainCandidate;if(o!=null){const r=fs(o,i);if(r>=0){if(!(i[r]instanceof tt))return this._intersectWithOtherCandidates(r,i,e,t,n);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,n))return this._updateSnappingCandidate(o,t,i,n)}}return this._intersectWithOtherCandidates(0,i,e,t,n)}_intersectWithOtherCandidates(e,t,i,n,o){const{coordinateHelper:r}=o,a=t[e],s=[];for(let l=0;l<t.length;++l){if(l===e)continue;const p=t[l],d=a.constraint.intersect(p.constraint);if(d)for(const u of d.closestPoints(a.targetPoint))s.push([new tt(At(u),a,p,p.isDraped),this._squaredScreenDistance(i,u,r)])}return s.length>0&&(s.sort((l,p)=>l[1]-p[1]),s[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(s[0][0],n,t,o):It(a,o.drawConstraints)?this._updateSnappingCandidate(a,n,t,o):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const a of i){if(e instanceof tt){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const s=a.constraint.closestTo(o);this._squaredScreenDistance(s,o,n.coordinateHelper)<gs()&&(a.targetPoint=o,this._currentOtherActiveCandidates.push(a),r.push(...a.hints))}return{snappedPoint:o,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return An(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return ys(e,t.spatialReference,Te,this.view)}get test(){}};var ce;c([h({constructOnly:!0})],W.prototype,"view",void 0),c([h()],W.prototype,"options",void 0),c([h({readOnly:!0})],W.prototype,"updating",null),c([h()],W.prototype,"_loadTask",void 0),c([h()],W.prototype,"_engines",void 0),c([h()],W.prototype,"_squaredMouseProximityThreshold",null),c([h()],W.prototype,"_squaredTouchProximityThreshold",null),W=c([C("esri.views.interactive.snapping.SnappingManager")],W),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(ce||(ce={}));const kt="visualization-handle";function gs(){return lt.satisfiesConstraintScreenThreshold*lt.satisfiesConstraintScreenThreshold}function It(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof ps||e instanceof ls||e instanceof cs||e instanceof hs||e instanceof us)&&(!(e instanceof ds)||t.direction==null&&e.selfSnappingType===gt.LastVertex)}function fs(e,t){return e instanceof tt?Ct(t,e.first)>=0&&Ct(t,e.second)>=0?0:-1:Ct(t,e)}function Ct(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.equals(e[n].constraint)){i=n;break}return i}function vs(e){return e.scenePoint!=null}function ms({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Te:t}let Pe=class extends re{constructor(e){super(e),this.labels=new pi,this.tooltips=new li,this.values=new ci}};c([h({nonNullable:!0,type:pi})],Pe.prototype,"labels",void 0),c([h({nonNullable:!0,type:li})],Pe.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:ci})],Pe.prototype,"values",void 0),Pe=c([C("esri.views.interactive.sketch.SketchOptions")],Pe);const kn=Pe;function ki(e,t,i){if(!t||!e?.map)return;const{map:n}=e,o=n.layers.find(r=>r===t);o||n.add(t,i),o&&i!=null&&n.layers.reorder(o,i)}function ba(e,t){const i=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(n=>{const o=n.layer;return o===i||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(i)})}function _s(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Es(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var Ii;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(Ii||(Ii={}));function Ci(e){switch(e){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function bs(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const i=e.elevationInfo;return Et(i)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function ws(e){return Ts(e).result}function Ts(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:b.GEOMETRY_MISSING};if(Et(e.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,i=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:b.SUPPORTED,geometry:i}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function Ss(e){if(e.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return b.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(i=>i.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:Ko(e)!=="on-the-ground"&&Jo(e)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}let x=class extends zt.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:Nn(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],x.prototype,"activeComponent",void 0),c([h()],x.prototype,"cancelled",void 0),c([h()],x.prototype,"history",void 0),c([h()],x.prototype,"tool",null),c([h()],x.prototype,"type",void 0),c([h()],x.prototype,"canUndo",null),c([h()],x.prototype,"canRedo",null),c([h()],x.prototype,"onEnd",void 0),c([h()],x.prototype,"undo",null),c([h()],x.prototype,"redo",null),c([h()],x.prototype,"toggleTool",void 0),c([h()],x.prototype,"addToSelection",void 0),c([h()],x.prototype,"removeFromSelection",void 0),x=c([C("esri.widgets.Sketch.support.OperationHandle")],x);let it=class extends x{};c([h()],it.prototype,"activeComponent",void 0),it=c([C("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],it);let he=class extends x{};c([h()],he.prototype,"activeComponent",void 0),he=c([C("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],he);const Di={defaultZ:0},Ce={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let m=class extends zt.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new lo,this._internalGraphicsLayer=new fo({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new di({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Hn({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Un({color:[130,130,130,1],width:2}),this.meshSymbol=new Vn({symbolLayers:new Ee([new Fn])}),this.updateGraphics=new Ee,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new di({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new kn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Di,this.defaultUpdateOptions=Ce,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new hi}initialize(){this.addHandles([ui(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),ui(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),_e(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},Ne),_e(()=>this.view,e=>{this._defaultSnappingManager=Be(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new W({view:e,options:this.snappingOptions})),e.type==="2d"?N(()=>import("./editingTools-KBOXuhog-Dlng1LhR.js"),__vite__mapDeps([73,1,2,3,4,74,10,11,35,75,76,77,36,9,78,27,79,24,47,55,46,48,37,80,40,41,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,25,26,5,6,7,8,30,31,32,33,34,38,39,42,43,44,45,49,50,51,52,53,54,56,57,58,59,60,61,62,63,83,84,85,12,86,87,88,89,90,91,92,93,94,95,96]),import.meta.url):e.type==="3d"&&(N(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([97,10,11,35,98,99,1,2,3,4,100,38,39,101,47,36,102,103,104,37,87,62,24,63,46,45,48,88,105,106,107,108,26,90,34,109,110,111,7,112,113,55,85,114,115,116,86,117,118,119,120,121,40,41,43,44,42,122,25,123,124,125,126,80,127,128,129,50,95,27,78,9,79,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,5,6,8,30,31,32,33,49,51,52,53,54,56,57,58,59,60,61,83,84,12,130,131,76,77,89,132,133,134,91,92,93,75,135,136,137,138,139,140,94]),import.meta.url).then(t=>t.e),N(()=>import("./LineCallout.glsl-B1CPwb2z-BKivUBAy.js"),__vite__mapDeps([141,2,3,1,4,142,143,44,39,43,118,36,11,38,113,63,46,47,55,48,37,85,114,24,45,35,34,101,102,103,104,10,87,62,88,105,106,107,108,99,98,26,90,109,110,111,7,112,119,120,121,40,41,42,122,25,123,115,32,33,17,18,144,59,60,61,136,145,126,50,146,147,148,149,150,151,152,23,27,153,154,155,156,157,158,159,160,161,162,163,164,165,5,6,8,30,166,167,66,67,168,127,15,16,19,20,21,22,9,49]),import.meta.url).then(t=>t.G)))},Ne),_e(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),ns(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Be(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Di,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Ce,...e,reshapeOptions:{...Ce.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Ce.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Be(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new W({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:n,map:o}=t;n&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles($n(()=>e.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Ne),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Rt(this._moduleLoaderAbortController),this._viewReadyAbortController=Rt(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:i,layer:n}=this,o=t.toArray();n.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),yi();if(i.activeTool!=null&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");ki(i,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const r=()=>{if(o===this._operationHandle){const a=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||a==null||n.add(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(vi(this.create(e,t)))}else l==="update"&&a&&this._updatingHandles.addPromise(vi(this.update([a])))}};o.on("complete",r),this._operationHandle=o,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:o}=this;if(!n||o==="disabled")throw i||this._logMissingLayer(),yi();n.activeTool!=null&&(n.activeTool=null);const r=Array.isArray(e)?e:[e];if(e==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(s=>s.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||a==null||A(a)||(ki(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)i.geometry==null||i.geometry.type==="mesh"||Ui(i.geometry.spatialReference,t.spatialReference)||(ho(i.geometry.spatialReference,t.spatialReference)||uo()||await yo(),i.geometry=Dt(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||o.push(a)});const r=await t.hitTest(e,{exclude:o});return as(r.results)}const i=[t.map.ground];t.map.allLayers.forEach(o=>{jn(o.type)&&i.push(o)});const n=await t.hitTest(e,{exclude:i});if(n.results.length>0){const o=n.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!n.ground.mapPoint||t.map.ground.opacity<1||n.ground.distance-(o.distance??0)>-Math.min(3*n.ground.distance,t.viewingMode==="global"?qn(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},G.WIDGET)]}async _handleImmediateClick(e){const t=await e.async(()=>this._getFirstHit(mi(e)));let i=null;if(t!=null){const n=t.graphic;this.updateGraphics.includes(n)||n.layer===this.layer?(e.stopPropagation(),i=n):this.view?.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,i,n);return o==null?null:(i.tools.add(o),i.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:n,defaultZ:o,hasZ:r,geometryToPlace:a,graphicProperties:s,mode:l,preserveAspectRatio:p}=i,d=_s(l,e),u=Es(e),f=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},y=f?.preserveAspectRatio??p??e!=="rectangle",g={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:n,defaultZ:o,forceUniformSize:y,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:a,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(N(()=>import("./editingTools-KBOXuhog-Dlng1LhR.js"),__vite__mapDeps([73,1,2,3,4,74,10,11,35,75,76,77,36,9,78,27,79,24,47,55,46,48,37,80,40,41,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,25,26,5,6,7,8,30,31,32,33,34,38,39,42,43,44,45,49,50,51,52,53,54,56,57,58,59,60,61,62,63,83,84,85,12,86,87,88,89,90,91,92,93,94,95,96]),import.meta.url));return A(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Ps(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([97,10,11,35,98,99,1,2,3,4,100,38,39,101,47,36,102,103,104,37,87,62,24,63,46,45,48,88,105,106,107,108,26,90,34,109,110,111,7,112,113,55,85,114,115,116,86,117,118,119,120,121,40,41,43,44,42,122,25,123,124,125,126,80,127,128,129,50,95,27,78,9,79,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,5,6,8,30,31,32,33,49,51,52,53,54,56,57,58,59,60,61,83,84,12,130,131,76,77,89,132,133,134,91,92,93,75,135,136,137,138,139,140,94]),import.meta.url).then(n=>n.e));if(A(t)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:i,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const n=e.forceUniformSize,o=e.centered,r=[t.on("key-down",s=>{if(s.key===R.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===R.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==R.vertexAdd||s.repeat)s.key===R.undo?(s.stopPropagation(),a.undo()):s.key===R.redo?(s.stopPropagation(),a.redo()):s.key!==R.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===R.center&&(s.repeat||(e.centered=!o,s.stopPropagation())):(e.forceUniformSize=!n,s.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}},G.WIDGET),t.on("key-up",s=>{s.key===R.pan?e.enabled=!0:s.key!==R.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===R.center&&(e.centered=o,s.stopPropagation()):(e.forceUniformSize=n,s.stopPropagation())},G.WIDGET),e.on("vertex-add",s=>{switch(i=i==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",s=>{this._set("createGraphic",s.graphic),i="complete",s.aborted?a&&a.cancel():a&&a.complete()}),_e(()=>this._getGraphicSymbolFromTool(e.geometryType),s=>{e.graphicSymbol=s})],a=new it({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{J(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:n}=this;if(!n)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=o.tool??Ce.tool;for(const a of e)i.remove(a),i.add(a);if(n.type==="3d"){if(e.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(e,o,n,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,n);case"transform":return this._setupGraphicTransform3DOperation(e,o,n)}}switch(r){case"move":return this._setupMove2DOperation(e,o,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,o,n);case"transform":if(e.length===1){const a=e[0].geometry?.type;a!=="point"&&a!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,o,n)}}async _setupMove3DOperation(e,t,i,n,o=!1){const r=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([97,10,11,35,98,99,1,2,3,4,100,38,39,101,47,36,102,103,104,37,87,62,24,63,46,45,48,88,105,106,107,108,26,90,34,109,110,111,7,112,113,55,85,114,115,116,86,117,118,119,120,121,40,41,43,44,42,122,25,123,124,125,126,80,127,128,129,50,95,27,78,9,79,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,5,6,8,30,31,32,33,49,51,52,53,54,56,57,58,59,60,61,83,84,12,130,131,76,77,89,132,133,134,91,92,93,75,135,136,137,138,139,140,94]),import.meta.url).then(y=>y.e));if(A(r))return r;const{ManipulatedObject3DGraphic:a,MoveTool3D:s}=r.module,l=new Map,p=()=>{l.forEach(y=>y.destroy()),l.clear()};for(const y of e){const g=new a({view:i,graphic:y}),_=bs(g);if(_!==b.SUPPORTED)return p(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Ci(_)}).`),null;l.set(y,g)}const d=new s({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(d),d.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(e);const u=[],f=new he({activeComponent:d,tool:n,type:"update",onEnd:()=>{J(u),Je(i,d),p()},undo:()=>{Hi(this.view,d),Ke(f,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Xe(f,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:y=>{this.updateGraphics.push(y);const g=new a({view:i,graphic:y});l.set(y,g),d.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const g=this.updateGraphics.indexOf(y);if(f.history.undo.forEach(T=>T.updates.splice(g,1)),f.history.redo.forEach(T=>T.updates.splice(g,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void f.complete();const _=l.get(y);_&&(d.objects.remove(_),_.destroy(),l.delete(y))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||n!=="transform")return;const y=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(y,t,i,!0);g&&!A(g)&&(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,t))}});return u.push(...this._getHandlesForComponent(f,t),i.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(f,y,t),G.WIDGET),i.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(f,y)},G.WIDGET)),f}_setupGraphicTransform3DOperation(e,t,i,n=!1){if(e.length===1&&Ss(e[0])===b.SUPPORTED){const o=e[0],r=o.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(o,t,i);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,i,n)}return this._setupMove3DOperation(e,t,i,"transform",n)}async _setupPointTransform3DOperation(e,t,i){const n="transform",{enableRotation:o,enableScaling:r,enableZ:a}=t,s=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([97,10,11,35,98,99,1,2,3,4,100,38,39,101,47,36,102,103,104,37,87,62,24,63,46,45,48,88,105,106,107,108,26,90,34,109,110,111,7,112,113,55,85,114,115,116,86,117,118,119,120,121,40,41,43,44,42,122,25,123,124,125,126,80,127,128,129,50,95,27,78,9,79,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,5,6,8,30,31,32,33,49,51,52,53,54,56,57,58,59,60,61,83,84,12,130,131,76,77,89,132,133,134,91,92,93,75,135,136,137,138,139,140,94]),import.meta.url).then(g=>g.e));if(A(s))return s;const{TransformTool3D:l,ManipulatedObject3DGraphic:p}=s.module,d=new p({graphic:e,view:i}),u=new l({object:d,view:i,enableRotation:o,enableScaling:r,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),this.updateGraphics.add(e);const f=[],y=new he({activeComponent:u,tool:n,type:"update",onEnd:()=>{J(f),Je(i,u),d.destroy()},undo:()=>{Hi(this.view,u),Ke(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Xe(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);A(_)||this._setUpdateOperationHandle(_,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return f.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),G.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},G.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,i,n=!1){const o="transform",{enableRotation:r,enableScaling:a,enableZ:s,preserveAspectRatio:l}=t,p=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([97,10,11,35,98,99,1,2,3,4,100,38,39,101,47,36,102,103,104,37,87,62,24,63,46,45,48,88,105,106,107,108,26,90,34,109,110,111,7,112,113,55,85,114,115,116,86,117,118,119,120,121,40,41,43,44,42,122,25,123,124,125,126,80,127,128,129,50,95,27,78,9,79,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,5,6,8,30,31,32,33,49,51,52,53,54,56,57,58,59,60,61,83,84,12,130,131,76,77,89,132,133,134,91,92,93,75,135,136,137,138,139,140,94]),import.meta.url).then(E=>E.e));if(A(p))return p;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:u}=p.module,f=this.view?.inputManager?.isModifierKeyDown(R.constraint),y=new d({view:i,graphic:e}),g=new u({object:y,view:i,enableRotation:r,enableScaling:a,enableZ:s,preserveAspectRatio:!!l!=!!f,sketchOptions:this.sketchOptions});i.tools.add(g),n||this.updateGraphics.add(e);const _=[],T=new he({activeComponent:g,tool:o,type:"update",onEnd:()=>{J(_),Je(i,g),y.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async E=>{this.updateGraphics.add(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[E],removed:[],type:"selection-change"},type:"update"}),T.onEnd(),T.destroy();const Le=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);A(Le)||this._setUpdateOperationHandle(Le,t)},removeFromSelection:E=>{this.updateGraphics.remove(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[E],type:"selection-change"},type:"update"}),T.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const E=await this._setupReshape3DOperation(e,t,i,!0);E&&!A(E)&&(T.onEnd(),T.destroy(),this._setUpdateOperationHandle(E,t))}});return _.push(...this._getHandlesForComponent(T,t),i.on("immediate-click",E=>this._getCommonUpdateOperationClickHandlers(T,E,t),G.WIDGET),i.on("key-down",E=>this._getCommonUpdateOperationKeyDownHandlers(T,E),G.WIDGET),i.on("key-down",E=>{E.key!==R.constraint||E.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},G.WIDGET),i.on("key-up",E=>{E.key===R.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},G.WIDGET)),T}async _setupMove2DOperation(e,t,i){const n="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,i);if(A(o))return o;const r=new he({activeComponent:o,tool:n,type:"update",onEnd:()=>{this._displayDefaultCursor(),J(l),J(s),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const p=this.updateGraphics.toArray();Ke(r,p),r.refreshComponent(),this._emitUndoEvent({graphics:p,tool:n})},redo:()=>{const p=this.updateGraphics.toArray();Xe(r,p),r.refreshComponent(),this._emitRedoEvent({graphics:p,tool:n})},addToSelection:async p=>{await this._updatingHandles.addPromise(this._updateSpatialReference(p)),this.updateGraphics.push(p),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:p=>{const d=this.updateGraphics.indexOf(p);r.history.undo.forEach(f=>f.updates.splice(d,1)),r.history.redo.forEach(f=>f.updates.splice(d,1)),this.updateGraphics.remove(p);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:r.complete()}});let a=!1;const s=[i.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(r,p,t),G.WIDGET),i.on("key-down",p=>{this._getCommonUpdateOperationKeyDownHandlers(r,p),p.key!==R.constraint||p.repeat||(a=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},G.WIDGET),i.on("key-up",p=>{p.key===R.constraint&&a&&(a=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},G.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,i,n=!1){const o="reshape",r=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([97,10,11,35,98,99,1,2,3,4,100,38,39,101,47,36,102,103,104,37,87,62,24,63,46,45,48,88,105,106,107,108,26,90,34,109,110,111,7,112,113,55,85,114,115,116,86,117,118,119,120,121,40,41,43,44,42,122,25,123,124,125,126,80,127,128,129,50,95,27,78,9,79,81,28,29,82,13,14,15,16,17,18,19,20,21,22,23,5,6,8,30,31,32,33,49,51,52,53,54,56,57,58,59,60,61,83,84,12,130,131,76,77,89,132,133,134,91,92,93,75,135,136,137,138,139,140,94]),import.meta.url).then(g=>g.e));if(A(r))return r;const{ManipulatedObject3DGraphic:a,ReshapeTool3D:s}=r.module,l=new a({view:i,graphic:e}),p=ws(l);if(p!==b.SUPPORTED)return l.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Ci(p)}).`),null;const d=t.reshapeOptions,u=new s({view:i,object:l,enableZVertex:t.enableZ&&d?.vertexOperation==="move",enableZShape:t.enableZ&&d?.shapeOperation==="move",enableMoveObject:d?.shapeOperation==="move"||d?.shapeOperation==="move-xy",enableMidpoints:d?.edgeOperation==="split",enableEdgeOffset:d?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),n||this.updateGraphics.add(l.graphic);const f=[],y=new he({activeComponent:u,tool:o,type:"update",onEnd:()=>{J(f),Je(i,u),l.destroy()},canUndo:()=>!u.destroyed&&u.canUndo,undo:()=>{u.destroyed||(u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!u.destroyed&&u.canRedo,redo:()=>{u.destroyed||(u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);A(_)||this._setUpdateOperationHandle(_,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const g=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);A(g)||this._setUpdateOperationHandle(g,t)}});return f.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),G.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},G.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,i,n){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,i,n):await this._getReshape(e,i,n);if(A(o))return o;const r=new he({activeComponent:o,type:"update",onEnd:()=>{J(s),J(a),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Ke(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{Xe(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async l=>{let p=r.activeComponent;if(p?.type==="reshape"){const d=[...this.updateGraphics,l];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",i,n);if(A(u))return;this._setUpdateOperationHandle(u,i)}else this.updateGraphics.add(l),p.graphics=this.updateGraphics.toArray(),p.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const p=this.updateGraphics.indexOf(l);r.history.undo.forEach(u=>u.updates.splice(p,1)),r.history.redo.forEach(u=>u.updates.splice(p,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();if(d.length===0)r.complete();else{const u=d[0].geometry;d.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?r.activeComponent.graphics=d:r.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),p=l.geometry;if(p!=null&&(r.tool==="reshape"&&(p.type==="point"||p.type==="multipoint")||r.tool==="transform"&&p.type==="extent"))return;let d=null;r.tool==="transform"?d=await this._getReshape([l],i,n):r.tool==="reshape"&&(d=await this._getBox([l],i,n)),A(d)||(r.activeComponent?.destroy(),r.activeComponent=d,r.activeComponent&&(J(s),s=this._getHandlesForComponent(r,i)))}}),a=[n.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(r,l,i),G.WIDGET),n.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,l),l.key===R.constraint&&!l.repeat&&r){const p=r.activeComponent;p&&p.type==="box"&&(p.preserveAspectRatio=!p.preserveAspectRatio)}},G.WIDGET),n.on("key-up",l=>{if(l.key===R.constraint&&r){const p=r.activeComponent;p&&p.type==="box"&&(p.preserveAspectRatio=!p.preserveAspectRatio)}},G.WIDGET)];let s=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:n,highlightOptions:o}=t,r=await this._requireModule(N(()=>import("./GraphicMover-CiNX1V2i-DNJJBwFq.js"),__vite__mapDeps([169,1,2,3,4,15,16,17,18,19,20,21,22,23,24,11,25,26,96,127,30,170,27,171,172,5,6,7,8,94,10,36,39,44,56,33,9,35,43,49,59,60,61,37,38,45,46,47,48,62,63]),import.meta.url).then(a=>a.G));return A(r)?r:new r.module.default({enableMoveAllGraphics:n,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:a,dy:s,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:s,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:s,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:n,enableScaling:o,highlightOptions:r,preserveAspectRatio:a}=t,s=await this._requireModule(N(()=>import("./Box-CcaqKOvu-BB1-ytRz.js"),__vite__mapDeps([173,1,2,3,4,9,96,169,15,16,17,18,19,20,21,22,23,24,11,25,26,127,30,170,27,171,172,5,6,7,8,94,10,36,39,44,56,33,35,43,49,59,60,61,37,38,45,46,47,48,62,63,174,78,79,55,80,40,41,81,28,29,82,13,14,31,32,34,42,50,51,52,53,54,57,58,83,84,85,12,140,133]),import.meta.url));if(A(s))return s;const l=this.view?.inputManager?.isModifierKeyDown(R.constraint);return new s.module.default({graphics:e,enableRotation:n,enableScaling:o,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!a!=!!l,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMove:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMoveStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScale:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotate:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"})}})}async _getReshape(e,t,i){const n=t.reshapeOptions?.edgeOperation==="split",o=t.reshapeOptions?.shapeOperation==="move",r=!!t.highlightOptions?.enabled,a=await this._requireModule(N(()=>import("./Reshape-BUYuf7aU-DpkBvzpB.js"),__vite__mapDeps([175,1,2,3,4,15,16,17,18,19,20,21,22,23,24,11,25,26,34,74,10,35,75,76,77,36,9,78,27,79,47,55,46,48,37,80,40,41,81,28,29,82,13,14,5,6,7,8,30,31,32,33,38,39,42,43,44,45,49,50,51,52,53,54,56,57,58,59,60,61,62,63,83,84,85,12,86,87,88,96,169,127,170,171,172,94,132,133,174]),import.meta.url));return A(a)?a:new a.module.default({enableMidpoints:n,enableMovement:o,graphic:e[0],highlightsEnabled:r,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:i,callbacks:{onReshapeStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s},type:"update"}),onReshape:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s},type:"update"}),onReshapeStop:({mover:s,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s,type:l},type:"update"}),onMoveStart:({dx:s,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:l,mover:p,type:d},type:"update"}),onMove:({dx:s,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:l,mover:p,type:d},type:"update"}),onMoveStop:({dx:s,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:l,mover:p,type:d},type:"update"}),onVertexAdd:({added:s,type:l,vertices:p})=>{const d=s.map(u=>gi(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:p,type:l},type:"update"})},onVertexRemove:({removed:s,type:l,vertices:p})=>{const d=s.map(u=>gi(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:p,type:l},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:o})=>{o.native?.shiftKey&&(o.stopPropagation(),e.removeFromSelection(n))}),i.on("graphic-move-start",n=>e.addToHistory(de(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),i.on("move-start",n=>e.addToHistory(de(n.graphics))),i.on("rotate-start",n=>e.addToHistory(de(n.graphics))),i.on("scale-start",n=>e.addToHistory(de(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),i.on("move-start",n=>e.addToHistory(de([n.mover]))),i.on("reshape-start",n=>e.addToHistory(de([n.graphic]))),i.on("vertex-add",n=>e.addToHistory(de([n.oldGraphic]))),i.on("vertex-remove",n=>e.addToHistory(de([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{e.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{e.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:n,viewEvent:o}=i;return o.native?.shiftKey&&n.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(n)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);const n=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",n)}async _getCommonUpdateOperationClickHandlers(e,t,i){const n=mi(t),o=await t.async(()=>this._getFirstHit(n));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,i))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const n=!!i.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!n||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===R.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===R.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===R.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&R.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,i=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Be(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,i){Vi.getLogger(this).error(new zn(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return fi(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(Rt(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Zn(fi(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Ni("view"))}_logMissingLayer(){this._logError(Os,Ni("layer"))}};c([h()],m.prototype,"_defaultSnappingManager",void 0),c([h()],m.prototype,"updating",null),c([h({readOnly:!0})],m.prototype,"_updatingHandles",void 0),c([h()],m.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],m.prototype,"activeTool",null),c([h({readOnly:!0})],m.prototype,"activeCreateToolDrawMode",null),c([h()],m.prototype,"activeTooltip",null),c([h({types:ke})],m.prototype,"activeFillSymbol",void 0),c([h()],m.prototype,"activeLineSymbol",void 0),c([h()],m.prototype,"activeVertexSymbol",void 0),c([h()],m.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],m.prototype,"createGraphic",null),c([h()],m.prototype,"defaultCreateOptions",null),c([h()],m.prototype,"defaultUpdateOptions",null),c([h({type:pi,nonNullable:!0})],m.prototype,"labelOptions",null),c([h()],m.prototype,"layer",void 0),c([h({types:ke})],m.prototype,"pointSymbol",void 0),c([h({types:ke})],m.prototype,"polygonSymbol",void 0),c([h({types:ke})],m.prototype,"polylineSymbol",void 0),c([h()],m.prototype,"meshSymbol",void 0),c([h({type:hi,nonNullable:!0})],m.prototype,"snappingOptions",null),c([h()],m.prototype,"snappingManager",null),c([h({readOnly:!0})],m.prototype,"state",null),c([h({type:li,nonNullable:!0})],m.prototype,"tooltipOptions",null),c([h({readOnly:!0})],m.prototype,"updateGraphics",void 0),c([h()],m.prototype,"updateOnGraphicClick",void 0),c([h()],m.prototype,"creationMode",void 0),c([h({type:ci,nonNullable:!0})],m.prototype,"valueOptions",null),c([h({types:ke})],m.prototype,"vertexSymbol",void 0),c([h({value:null})],m.prototype,"view",null),c([h({constructOnly:!0,type:kn})],m.prototype,"sketchOptions",void 0),m=c([C("esri.widgets.Sketch.SketchViewModel")],m);const Os="sketch:missing-property",Ni=e=>`Property '${e}' is missing on SketchViewModel.`;function Ps(e){return e==="polygon"||e==="rectangle"||e==="circle"}function Ke(e,t){In("undo",e.history.undo,e.history.redo,t)}function Xe(e,t){In("redo",e.history.redo,e.history.undo,t)}function In(e,t,i,n){const o=t.pop();if(!o)return;const r=o.updates,a=[];n.forEach((s,l)=>{const p=r[l];p!=null&&("geometry"in p&&p.geometry!=null&&(a.push({geometry:s.geometry}),s.geometry=p.geometry),"symbol"in p&&p.symbol!=null&&(a.push({symbol:s.symbol}),s.symbol=p.symbol),"undo"in p&&(a.push(p),p[e](s)))}),i.push({updates:a})}function Hi(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function de(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function Je(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function A(e){return"requireError"in e&&e.requireError==="aborted"}const wa=m;export{Ko as $,ga as A,ba as B,oe as C,U as D,ur as E,ns as F,ln as G,lt as H,na as I,Xr as J,Wo as K,fa as L,R as M,bt as N,P as O,De as P,I as Q,ya as R,Ws as S,kn as T,oa as U,sa as V,wi as W,Xo as X,ts as Y,ys as Z,ai as _,j as a,_a as a0,bi as a1,At as a2,aa as a3,An as a4,cs as a5,Kr as a6,gn as a7,ta as a8,me as a9,Qo as aA,Ys as aB,ki as aC,ea as aD,Xs as aE,Qs as aF,Js as aG,Ks as aH,ma as aI,hs as aa,gt as ab,ds as ac,yt as ad,ia as ae,us as af,rn as ag,tt as ah,Ln as ai,ls as aj,ps as ak,va as al,Ea as am,Bo as an,bs as ao,b as ap,Wt as aq,Bs as ar,ca as as,or as at,la as au,ha as av,Z as aw,pr as ax,Ji as ay,en as az,B as b,hi as c,ci as d,er as e,Rr as f,Kt as g,Ii as h,Tr as i,dt as j,Wr as k,Gr as l,Me as m,ra as n,ua as o,tr as p,as as q,da as r,Tn as s,wa as t,Te as u,xn as v,pi as w,dr as x,Gi as y,pa as z};
