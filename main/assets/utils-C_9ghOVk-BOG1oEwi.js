const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-CPlRnYsF-s0hSM0h3.js","./main-evhEtFYV.js","./main-C9A24L49.css","./story-BSn8dUZd.js","./story-Dmm6P95U.css","./LRUCache-BLmkvs7b-1i_aXPGT.js","./MemCache-BCippCv6-rFeo-JvT.js"])))=>i.map(i=>d[i]);
import{_ as v}from"./main-evhEtFYV.js";import{cV as u,a7 as p,e_ as m,b as _,e$ as S,f0 as E,eO as c,ar as O,eN as R,f1 as I}from"./story-BSn8dUZd.js";import{c as $}from"./jsonUtils-DzmXEA9_-C8OJGP_1.js";import{d as w}from"./cimSymbolUtils-BuFg2oLA-BJOVW6OA.js";import{i as A}from"./LRUCache-BLmkvs7b-1i_aXPGT.js";const g="picture-fill",k="simple-fill",M="simple-line",x="simple-marker",N="text",P="cim",b=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new A(1e3);function rt(t){const n=t.style;let e=null;if(t)switch(t.type){case x:n!=="cross"&&n!=="x"&&(e=t.color);break;case k:n&&n!=="solid"?n!=="none"&&(e={type:"pattern",x:0,y:0,src:O(`esri/symbols/patterns/${n}.png`),width:5,height:5}):e=t.color;break;case g:e={type:"pattern",src:t.url,width:c(t.width)*t.xscale,height:c(t.height)*t.yscale,x:c(t.xoffset),y:c(t.yoffset)};break;case N:e=t.color;break;case P:e=w(t)}return e}function ot(t,n){const e=t+"-"+n;return d.get(e)!==void 0?Promise.resolve(d.get(e)):_(t,{responseType:"image"}).then(r=>{const o=r.data,l=o.naturalWidth,i=o.naturalHeight,s=document.createElement("canvas");s.width=l,s.height=i;const a=s.getContext("2d");a.fillStyle=n,a.fillRect(0,0,l,i),a.globalCompositeOperation="destination-in",a.drawImage(o,0,0);const f=s.toDataURL();return d.put(e,f),f})}function L(t){if(!t)return null;let n=null;switch(t.type){case k:case g:case x:n=L(t.outline);break;case M:{const e=c(t.width);t.style!=null&&t.style!=="none"&&e!==0&&(n={color:t.color,style:V(t.style),width:e,cap:t.cap,join:t.join==="miter"?c(t.miterLimit):t.join},n.dashArray=T(n).join(",")||"none");break}default:n=null}return n}function T(t){if(!t?.style)return[];const{dashArray:n,style:e,width:r}=t;if(typeof n=="string"&&n!=="none")return n.split(",").map(i=>Number(i));const o=r??0,l=b.has(e)?b.get(e).map(i=>i*o):[];if(t.cap!=="butt")for(const[i,s]of l.entries())l[i]=i%2==1?s+o:Math.max(s-o,1);return l}const V=(()=>{const t={};return n=>{if(t[n])return t[n];const e=n.replaceAll("-","");return t[n]=e,e}})(),lt=new u([128,128,128]),W=new u("white");function C(t){const n=t.symbolLayers?.at(-1);if(n&&"outline"in n)return n?.outline?.size}function it(t){return t?p(t)?C(t)??0:R(L(t)?.width):0}function at(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(n=>n.type==="object");case"line-3d":return t.symbolLayers.some(n=>n.type==="path");case"polygon-3d":return t.symbolLayers.some(n=>n.type==="object"||n.type==="extrude");default:return!1}}function st(t){return t.resource?.href??""}function ct(t,n){if(!t)return null;let e=null;return p(t)?e=D(t):m(t)&&(e=t.type==="cim"?w(t):t.color?new u(t.color):null),e?y(e,n):null}function D(t){const n=t.symbolLayers;if(!n)return null;let e=null;return n.forEach(r=>{r.type==="object"&&r.resource?.href||(e=r.type==="water"?r.color:r.material?r.material.color:null)}),e?new u(e):null}function y(t,n){if(n==null||t==null)return t;const e=t.toRgba();return e[3]=e[3]*n,new u(e)}function H(t,n,e){const r=t.symbolLayers;if(!r)return;const o=l=>y(n=n??l??(e!=null?W:null),e);r.forEach(l=>{if(l.type!=="object"||!l.resource?.href||n)if(l.type==="water")l.color=o(l.color);else{const i=l.material!=null?l.material.color:null,s=o(i);l.material==null?l.material=new S({color:s}):l.material.color=s,e!=null&&"outline"in l&&l.outline?.color!=null&&(l.outline.color=y(l.outline.color,e))}})}function J(t,n,e){(n=n??t.color)&&(t.color=y(n,e)),e!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=y(t.outline.color,e))}function ut(t,n,e){t&&(n||e!=null)&&(n&&(n=new u(n)),p(t)?H(t,n,e):m(t)&&J(t,n,e))}async function K(t,n){const e=t.symbolLayers;e&&await E(e,async r=>U(r,n))}async function U(t,n){switch(t.type){case"extrude":q(t,n);break;case"icon":case"line":case"text":Y(t,n);break;case"path":F(t,n);break;case"object":await B(t,n)}}function Y(t,n){const e=j(n);e!=null&&(t.size=e)}function j(t){for(const n of t)if(typeof n=="number")return n;return null}function q(t,n){t.size=typeof n[2]=="number"?n[2]:0}async function B(t,n){const{resourceSize:e,symbolSize:r}=await G(t),o=z(n,e,r);t.width=h(n[0],r[0],e[0],o),t.depth=h(n[1],r[1],e[1],o),t.height=h(n[2],r[2],e[2],o)}function F(t,n){const e=z(n,I,[t.width,void 0,t.height]);t.width=h(n[0],t.width,1,e),t.height=h(n[2],t.height,1,e)}function z(t,n,e){for(let r=0;r<3;r++){const o=t[r];switch(o){case"symbol-value":{const l=e[r];return l!=null?l/n[r]:1}case"proportional":break;default:if(o&&n[r])return o/n[r]}}return 1}async function G(t){const{computeObjectLayerResourceSize:n}=await v(()=>import("./symbolLayerUtils-CPlRnYsF-s0hSM0h3.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),e=await n(t,10),{width:r,height:o,depth:l}=t,i=[r,l,o];let s=1;for(let a=0;a<3;a++){const f=i[a];if(f!=null){s=f/e[a];break}}for(let a=0;a<3;a++)i[a]==null&&(i[a]=e[a]*s);return{resourceSize:e,symbolSize:i}}function h(t,n,e,r){switch(t){case"proportional":return e*r;case"symbol-value":return n??e;default:return t}}function Q(t,n){const e=j(n);if(e!=null)switch(t.type){case"simple-marker":t.size=e;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=e,t.height=e*r):(t.width=e*r,t.height=e);break}case"simple-line":t.width=e;break;case"text":t.font.size=e}}async function ft(t,n){if(t&&n)return p(t)?K(t,n):void(m(t)&&Q(t,n))}function ht(t,n,e){if(t&&n!=null)if(p(t)){const r=t.symbolLayers;r&&r.forEach(o=>{if(o.type==="object")switch(e){case"tilt":o.tilt=(o.tilt??0)+n;break;case"roll":o.roll=(o.roll??0)+n;break;default:o.heading=(o.heading??0)+n}o.type==="icon"&&(o.angle+=n)})}else m(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=n))}function yt(t){if(!t)return null;const n=t.effects.filter(e=>e.type!=="bloom").map(e=>e.toJSON());return $(n)}function pt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(n=>n.type==="extrude")}export{st as $,rt as F,ot as G,lt as P,ut as V,it as W,at as Y,pt as a,L as b,ht as i,T as j,yt as l,ct as q,ft as s,V as z};
