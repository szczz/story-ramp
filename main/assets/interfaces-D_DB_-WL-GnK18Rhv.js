const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingTools-CWx0-1A2-PBrCZS45.js","./vec2-BnynUbeJ-CKtGJQAy.js","./common-CYWrYyJl-E8-sukrT.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./glsl-o28TenZV-B0eZUNn3.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./story-BSn8dUZd.js","./main-evhEtFYV.js","./main-C9A24L49.css","./story-Dmm6P95U.css","./ShaderBuilder-BkQM64Qp-B8KbVyjs.js","./VertexAttribute-DFC3a3eR-BhmQtMsu.js","./VerticalOffset.glsl-BtVaDxLq-BJdqTL10.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./vec32-BuqRmYBM-fJ1Go0LA.js","./Indices-DkAzsiH--B5a2XPyy.js","./InterleavedLayout-DcHoXu73-gAshwN4d.js","./BufferView-BBCzkcZS-CBnetIvv.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./triangle-BePBrXJ8-sKJGInLE.js","./sphere-Cj20syUS-DFxQs8pO.js","./mat4-BFStKTjU-CckVUlHi.js","./mat3-DOnW3DjW-C3hbW9XY.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./plane-B_adY3_o-CokMJNDw.js","./quatf64-C16JxGFv-BKWK1F8U.js","./lineSegment-BJNfNZM5-Cq_CP3OB.js","./renderState-DlSSrLcZ-Du_EmLq6.js","./enums-DBi1-Mm2-CUS1pvQe.js","./ShaderOutput-C_OqLoo1-jp3zUBgm.js","./lengthUtils-wU9RRIqK-CfCyp1oe.js","./boundedPlane-B6TkXVHT-nRk2Mtao.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./requestImageUtils-rT_rMd2F-Cj_04cWc.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./Texture-DXSFJsEu-DWK_6IB9.js","./signal-DxzURL18-BIml8fr1.js","./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js","./orientedBoundingBox-CTsjUkMw-BNSgHqc0.js","./quat-D8L_R4I0-OzMeraP9.js","./spatialReferenceEllipsoidUtils-DlQOpWof-DP5ttsCl.js","./computeTranslationToOriginAndRotation-DwwrTl3S-B-NRiStg.js","./projection-m8vi7Cxv-DabLaeW0.js","./colorUtils-DxUhbS7D-CKu_u3DP.js","./SketchViewModel-T2dNp9Tt-3p57BKDB.js","./UpdatingHandles-DBzjq66S-DzzPDZ40.js","./GraphicsLayer-GkJJfSu5-DzPWwO25.js","./GraphicsCollection-rAFZo1AJ-Bc0t9BxY.js","./Layer-B8q-l4yV-BhNvh7El.js","./TimeExtent-gZaEUVeW-lmURPZs3.js","./ScaleRangeLayer-DIxukUBC-C7_PRh3E.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-DzmXEA9_-C8OJGP_1.js","./parser-hXQyB-Qx-BPRVbg8f.js","./mat4f32-CiZjBg9k-CUm34GoR.js","./ElevationInfo-DkWlof50-BTc9ty9m.js","./globalCss-CFN4F315-DYIQb7lw.js","./Queue-B8H6jIv7-DermpPUZ.js","./Version-BTMwSXf1-BONRzg8I.js","./quantityUtils-RaoZoCNH-D6-sPzO8.js","./projectVectorToVector-D0K_S4MR-C72UTjz2.js","./projectPointToVector-CG1hALQu-B2iw0lS4.js","./geodesicUtils-DV-lFWtb-CC8V699D.js","./Query-CxQYWcUQ-11z6jJGU.js","./Field-Cj6Pz3TI-snRwZE73.js","./fieldType-VTpxE-EM-FRk-VB8i.js","./intl-DLmy-Li5-DDXPhh_U.js","./automaticLengthMeasurementUtils-BcfJmFU0-GaA-zpd5.js","./MeshTransform-CvTryVbE-CT0sSY5G.js","./axisAngleDegrees-nTnQhoaG-BKqT15kA.js","./meshVertexSpaceUtils-BwEbYR8F-DrEhZ7-Z.js","./MeshLocalVertexSpace-DFCiKNRA-ByX4RoVJ.js","./themeUtils-RB4IoNvm-uO-dsvgO.js","./jsxFactory-C5LxVioS-CGvUzJGx.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./a11yUtils-C2ydunC--CvTmJV-1.js","./index-CVKk0WAC-dv5DdI9y.js","./draw-store-C1_quxsr-BZeAFUWU.js","./layerViewUtils-Bk5QNiAa-Bt7QzLfU.js","./widget-BgluoE6k-CZveemS_.js","./diffUtils-BSe9IE26-C0UB3KDP.js","./hydratedFeatures-BDT5zTGB-FnFE3iun.js","./Scheduler-Br-2v2ys-BRWpgHYn.js","./geometryEngineBase-DueYg7ux-CCeespPx.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-Bae3cp-4-Spz3nvCH.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./drapedUtils-7RfmdK5D-Mq_D3x-D.js","./utils-C0LvbFCo-RMQaTNpt.js","./substitute-TfjvVaWd-Ce43VeFX.js","./unitFormatUtils-zTNxheG9-Dr5zq753.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./geodesicLengthMeasurementUtils-X1SKKkBz-BHYF0tix.js","./TextOverlayItem-pAuO460X-DMt2fv0_.js","./Octree-Kk-G5P_T-BYr8m88P.js","./RibbonLine.glsl-B9kKeq0l-CMXebr7P.js","./HUDVisibility.glsl-Bl7zdrV0-MU7lhvd7.js","./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js","./vec3f32-BS0cezmI-B_madU1n.js","./floatRGBA-YJlz5IlR-BqAqHoR4.js","./glUtil-n1JOrdV3-CRAZdee5.js","./VertexElementDescriptor-BAy1DPb3-BOhpDZGx.js","./HUDMaterial.glsl-DUfp5PMk-Dgdk0W9o.js","./VertexArrayObject-DTkLCIKs-DBLROU32.js","./memoryEstimations-iHVpvWPf-DeCWdaPR.js","./automaticAreaMeasurementUtils-Bz1iefP0-B3yN_IOB.js","./PointSnappingHint-ClwQ1VNw-BYBcUcMs.js","./earcut-XDcq3zAf-BcwyrT7l.js","./editPlaneUtils-CYBM1uSC-Dv2srFPK.js","./SelectedVertexTooltipInfo-C6fS9jtg-BX1GwUWn.js","./TranslateTooltipInfo-BmeZ3crn-B6fePdIC.js","./utils-C_9ghOVk-BOG1oEwi.js","./cimSymbolUtils-BuFg2oLA-BJOVW6OA.js","./utils-BYqzY6_X-BqsSqIka.js","./defaultCIMValues-gWpu7WSC-cjxb95kj.js","./enums-f9UUstHQ-hLTu4V1l.js","./LRUCache-BLmkvs7b-1i_aXPGT.js","./MemCache-BCippCv6-rFeo-JvT.js","./IViewEvents-BE10MM98-CvMfjolG.js","./MD5-CHHr-oed-SuyrCYQ0.js","./multiOriginJSONSupportUtils-DGETddQl-BrWaY9_8.js","./ExtentScaleTooltipInfo-DGVFaJSb-Cl_Q5r7o.js","./GraphicManipulator-DXPP3gDs-BdMjqcaS.js","./triangulationUtils-KRNFVU70-C4boufVo.js","./deduplicate-DZCyc4JG-Ba5zK5kL.js","./HighlightDefaults-Cg50f_1y-DUcgMhSs.js","./NestedMap-Ddo7BfvO-BpVPk8mz.js"])))=>i.map(i=>d[i]);
import{_ as Q}from"./main-evhEtFYV.js";import{m as V,B as Ki,b as ee,v as de,A as Ce,M as Ht,i as ge,P as R,_ as Zi,j as Vt,d as Ji}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as x}from"./vec2f64-CEUyUoff-BBc0aQ6D.js";import{y as er,m as Si,o as Dt}from"./vec4f64-CjUMzAyX-DPYbdAom.js";import{v as c,bx as De,I as w,co as Be,Y as Ee,t as Y,gh as Et,ai as pe,c4 as wt,F as Pe,jX as Ke,a_ as tr,a as ir,aE as Ut,c$ as rr,ly as sr,de as be,dJ as ht,k6 as Ii,gg as ar,ci as ke,lz as Wt,kv as or,a8 as nr,a5 as lr,cr as Pi,cC as Ae,dv as hr,gN as cr,go as ur,kW as $t,eP as dr}from"./story-BSn8dUZd.js";import{h as gr,o as pr}from"./projection-m8vi7Cxv-DabLaeW0.js";import{Q as Qe,g as A,aM as Fe,X as At,e as W,af as _r,a1 as Di,c as Ze,az as mr,b0 as Ft,aq as st,a2 as Ei,aU as fr,a5 as vr,a9 as xr,ac as yr,m as wr,f as Cr,ad as br,ae as Tr,Z as Or,p as Rr,O as Sr,at as Ir,au as ct,av as $,a as Pr,Y as M,k as Je,b1 as Dr,j as ut,i as Er,o as Ar,n as Fr,aQ as Mr,aT as Lr,aR as Nr,y as Ai,z as Fi,K as X,R as K,b2 as Hr,b3 as Vr,b4 as Ur,aA as Wr,w as $r,aD as zr,aX as qr,b5 as Gr,F as jr,aB as Br,b6 as dt,aE as kr,aF as Qr,aG as Yr,U as Xr,aH as Kr,aI as Zr,aJ as Jr,aK as es,u as gt,ai as ts,ah as is,ax as zt,ao as qt,aV as Gt}from"./VerticalOffset.glsl-BtVaDxLq-BJdqTL10.js";import{w as rs}from"./Indices-DkAzsiH--B5a2XPyy.js";import{l as Mi}from"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";import{M as Z}from"./orientedBoundingBox-CTsjUkMw-BNSgHqc0.js";import{T as y}from"./VertexAttribute-DFC3a3eR-BhmQtMsu.js";import{a as Me,V as _e,i as ss,e as ae,r as Ve}from"./InterleavedLayout-DcHoXu73-gAshwN4d.js";import{f as as,U as os,N as jt,B as Ct,z as ns,b as ls,k as hs,$ as Bt}from"./mat4-BFStKTjU-CckVUlHi.js";import{a as ie,n as H}from"./mat4f64-BaJwL7tQ-k0uMm8LY.js";import{A as Li,T as cs,_ as q,Q as us,Z as Ni,v as ds,l as gs,N as ps,b as _s,r as ms}from"./vec32-BuqRmYBM-fJ1Go0LA.js";import{S as fs,U as vs,z as xs}from"./sphere-Cj20syUS-DFxQs8pO.js";import{I as ys}from"./plane-B_adY3_o-CokMJNDw.js";import{o as D,w as pt,e as kt,f as ws,h as Hi}from"./ShaderOutput-C_OqLoo1-jp3zUBgm.js";import{a as Mt,d as Re,Q as B,M as Lt,F as k,P as Cs}from"./renderState-DlSSrLcZ-Du_EmLq6.js";import{e as C}from"./glsl-o28TenZV-B0eZUNn3.js";import{w as J}from"./ShaderBuilder-BkQM64Qp-B8KbVyjs.js";import{I as Ie,U as bs,M as Vi,R as se,n as Qt,T as Ts,P as Ui,f as Os}from"./enums-DBi1-Mm2-CUS1pvQe.js";import{I as et,H as Wi}from"./triangulationUtils-KRNFVU70-C4boufVo.js";import{a as Rs,v as Ss,Q as Ue,K as Yt,t as Is,e as Ps,M as Ds}from"./RibbonLine.glsl-B9kKeq0l-CMXebr7P.js";import{f as Es,h as at,u as As}from"./HUDMaterial.glsl-DUfp5PMk-Dgdk0W9o.js";import{n as $i}from"./BindType-CKbZk6AG-Bqvzo9NX.js";import{o as _t}from"./signal-DxzURL18-BIml8fr1.js";import{o as Fs,V as Xt,D as Kt}from"./axisAngleDegrees-nTnQhoaG-BKqT15kA.js";import{l as Ms}from"./HighlightDefaults-Cg50f_1y-DUcgMhSs.js";import{n as Ye}from"./VertexElementDescriptor-BAy1DPb3-BOhpDZGx.js";import{u as Zt}from"./VertexArrayObject-DTkLCIKs-DBLROU32.js";import{H as zi,O as fe}from"./Texture-DXSFJsEu-DWK_6IB9.js";import{s as Ls}from"./NestedMap-Ddo7BfvO-BpVPk8mz.js";import{c as Ns}from"./HUDVisibility.glsl-Bl7zdrV0-MU7lhvd7.js";import{n as Hs}from"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import{y as Jt,D as Vs}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{i as Us,f as Ws}from"./Scheduler-Br-2v2ys-BRWpgHYn.js";function zo(e,t,i=null){const r=[],s=t.mapPositions;$s(t,r);const a=r[0][1].data,o=r[0][1].indices.length,n=rs(o);return zs(t,r,n),js(t,r,n),qs(t,r,n),Gs(t,r,n),Bs(t,r,n),ks(t,r,n),Qs(t,r,a),new Mr(e,r,s,Lr.Line,i)}function $s(e,t){const{attributeData:{position:i},removeDuplicateStartEnd:r}=e,s=Ys(i)&&r,a=i.length/3-(s?1:0),o=new Array(2*(a-1)),n=s?i.slice(0,-3):i;let l=0;for(let d=0;d<a-1;d++)o[l++]=d,o[l++]=d+1;t.push([y.POSITION,new Z(n,o,3,s)])}function zs(e,t,i){if(e.attributeData.colorFeature!=null)return;const r=e.attributeData.color;t.push([y.COLOR,new Z(r??er,i,4)])}function qs(e,t,i){e.attributeData.normal&&t.push([y.NORMAL,new Z(e.attributeData.normal,i,3)])}function Gs(e,t,i){e.attributeData.colorFeature!=null&&t.push([y.COLORFEATUREATTRIBUTE,new Z([e.attributeData.colorFeature],i,1,!0)])}function js(e,t,i){e.attributeData.sizeFeature==null&&t.push([y.SIZE,new Z([e.attributeData.size??1],i,1,!0)])}function Bs(e,t,i){e.attributeData.sizeFeature!=null&&t.push([y.SIZEFEATUREATTRIBUTE,new Z([e.attributeData.sizeFeature],i,1,!0)])}function ks(e,t,i){e.attributeData.opacityFeature!=null&&t.push([y.OPACITYFEATUREATTRIBUTE,new Z([e.attributeData.opacityFeature],i,1,!0)])}function Qs(e,t,i){if(e.overlayInfo==null||e.overlayInfo.renderCoordsHelper.viewingMode!==Mi.Global||!e.overlayInfo.spatialReference.isGeographic)return;const r=Ii(i.length),s=ar(e.overlayInfo.spatialReference);for(let _=0;_<r.length;_+=3)gr(i,_,r,_,s);const a=i.length/3,o=Nr(a+1);let n=Xs,l=Ks,d=0,g=0;V(n,r[g++],r[g++]),g++,o[0]=0;for(let _=1;_<a+1;++_)_===a&&(g=0),V(l,r[g++],r[g++]),g++,d+=Ki(n,l),o[_]=d,[n,l]=[l,n];t.push([y.DISTANCETOSTART,new Z(o,t[0][1].indices,1,!0)])}function Ys(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const Xs=x(),Ks=x(),qo=Me().vec3f(y.POSITION),Go=Me().vec3f(y.POSITION).vec2f(y.UV0),jo=Me().vec3f(y.POSITION).vec4u8(y.COLOR),Bo=Me().vec3f(y.POSITION).vec2f(y.UV0).vec4u8(y.OBJECTANDLAYERIDCOLOR);let Zs=class extends jr{intersect(e,t,i,r,s,a){return Br(e,i,r,s,void 0,a)}};const O={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Js={dash:O.dash,"dash-dot":[...O.dash,...O.dot],dot:O.dot,"long-dash":O["long-dash"],"long-dash-dot":[...O["long-dash"],...O.dot],"long-dash-dot-dot":[...O["long-dash"],...O.dot,...O.dot],none:null,"short-dash":O["short-dash"],"short-dash-dot":[...O["short-dash"],...O["short-dot"]],"short-dash-dot-dot":[...O["short-dash"],...O["short-dot"],...O["short-dot"]],"short-dot":O["short-dot"],solid:null},ea=8;function ta(e,t){return e==null?e:{pattern:e.slice(),pixelRatio:t}}function ko(e){return{pattern:[e,e],pixelRatio:2}}function Qo(e){return e?.type==="style"?ia(e.style):null}function ia(e){return e!=null?ta(Js[e],ea):null}var ei,ti;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(ei||(ei={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(ti||(ti={}));var j,ii,ri;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(j||(j={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(ii||(ii={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(ri||(ri={}));let si=class{constructor(){this._extent=ke(),this.resolution=0,this.renderLocalOrigin=Is(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new ra}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const t=.001*e.range;if(this._extent[0]-t<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Wt(this._extent,e.range,0,i)}if(this._extent[2]+t>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Wt(this._extent,-e.range,0,i)}}setupGeometryView(){this.canvasGeometries.numViews=1,or(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},ra=class{constructor(){this.extents=[ke(),ke(),ke()],this.numViews=0}};var b;(function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(b||(b={}));let sa=class{constructor(e,t,i){this._fbos=e,this._format=t,this._name=i}get valid(){return this._handle?.getTexture()!=null}dispose(){this._handle=Pe(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,i){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(t,i,this._name,this._format)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}},oe=class{constructor(e,t,i,r,s=$.RGBA_MIPMAP){this.output=i,this.content=r,this.fbo=new sa(e,s,t)}get valid(){return this.fbo.valid}},aa=class{constructor(e){this.targets=[new oe(e,"overlay color",D.Color,b.Color),new oe(e,"overlay IM color",D.Color,b.ColorNoRasterImage),new oe(e,"overlay highlight",D.Highlight,b.Highlight,$.RG),new oe(e,"overlay water",D.Normal,b.WaterNormal),new oe(e,"overlay occluded",D.Color,b.Occluded)],Ai()&&this.targets.push(new oe(e,"overlay olid",D.ObjectAndLayerIdColor,b.ObjectAndLayerIdColor,$.RGBA))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,t,i)=>t.valid?e|=1<<i:e,0)}};var ai;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"})(ai||(ai={}));var G,tt;function oa(e){return e!=null&&!e.running}(function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"})(G||(G={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(tt||(tt={}));var bt;let We=bt=class extends Ee{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new bt({cloudCover:this.cloudCover})}};c([De({cloudy:"cloudy"}),w({json:{write:{isRequired:!0}}})],We.prototype,"type",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],We.prototype,"cloudCover",void 0),We=bt=c([Y("esri.views.3d.environment.CloudyWeather")],We);var Tt;let $e=Tt=class extends Ee{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Tt({fogStrength:this.fogStrength})}};c([De({foggy:"foggy"}),w({json:{write:{isRequired:!0}}})],$e.prototype,"type",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$e.prototype,"fogStrength",void 0),$e=Tt=c([Y("esri.views.3d.environment.FoggyWeather")],$e);var Ot;let Te=Ot=class extends Ee{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Ot({cloudCover:this.cloudCover,precipitation:this.precipitation})}};c([De({rainy:"rainy"}),w({json:{write:{isRequired:!0}}})],Te.prototype,"type",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Te.prototype,"cloudCover",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Te.prototype,"precipitation",void 0),Te=Ot=c([Y("esri.views.3d.environment.RainyWeather")],Te);var Rt;let ne=Rt=class extends Ee{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Rt({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};c([De({snowy:"snowy"}),w({json:{write:{isRequired:!0}}})],ne.prototype,"type",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ne.prototype,"cloudCover",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ne.prototype,"precipitation",void 0),c([w({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],ne.prototype,"snowCover",void 0),ne=Rt=c([Y("esri.views.3d.environment.SnowyWeather")],ne);var St;let ze=St=class extends Ee{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new St({cloudCover:this.cloudCover})}};c([De({sunny:"sunny"}),w({json:{write:{isRequired:!0}}})],ze.prototype,"type",void 0),c([w({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ze.prototype,"cloudCover",void 0),ze=St=c([Y("esri.views.3d.environment.SunnyWeather")],ze);const mt=1e4,na=1e5;class la{constructor(){this.startTime=0,this._data=_t(null),this._readChannels=tt.RG,this.parallax=new oi,this.parallaxNew=new oi,this._anchorPoint=Ae(),this._fadeState=_t(m.HIDE),this._fadeFactor=_t(1)}get data(){return this._data.value}set data(t){this._data.value=t}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case m.HIDE:return 0;case m.FADE_OUT:return 1-this.fadeFactor;case m.FADE_IN:return this.fadeFactor;case m.SHOW:case m.CROSS_FADE:return 1}}fade(t,i,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?Pi((i-this.startTime)/(ca*r),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(t,i),this._updateParallax(t)}_evaluateState(t,i){const r=t.relativeElevation,s=this._updateAnchorPoint(t);(r>1.7*mt||r<-1e4||s>li)&&this.opacity>0?this._startFade(m.HIDE,i):this.isFading||(r>mt||r<-.35*mt||s>ua*li?this.opacity>0&&this._startFade(m.FADE_OUT,i):oa(this.data)&&(this.opacity===0?this._startFade(m.FADE_IN,i):this.data.state===G.Ready&&(this.fadeState===m.SHOW?this._startFade(m.CROSS_FADE,i):this._startFade(m.SHOW,i))))}_updateParallax(t){const i=ds(t.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(i-Be.radius*Be.radius,0))/Math.sqrt(i),Xt(ni,this.parallax.anchorPoint,le),Bt(this.parallax.transform,ie,le[3],Kt(le)),Xt(ni,this.parallaxNew.anchorPoint,le),Bt(this.parallaxNew.transform,ie,le[3],Kt(le))}_updateAnchorPoint(t){return gs(this._anchorPoint,t.eye),ps(this._anchorPoint,this._anchorPoint,Be.radius),this.fadeState===m.HIDE&&this.data?.state===G.Ready?(q(this.parallax.anchorPoint,this._anchorPoint),0):_s(ms(ha,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(t,i){switch(this._fadeState.value=t,this.startTime=i,t){case m.CROSS_FADE:this.requestFade(),this._switchReadChannels(),q(this.parallaxNew.anchorPoint,this._anchorPoint);break;case m.FADE_IN:this.requestFade(),this._switchReadChannels(),q(this.parallax.anchorPoint,this._anchorPoint),q(this.parallaxNew.anchorPoint,this._anchorPoint);break;case m.FADE_OUT:this.requestFade();break;case m.SHOW:this._switchReadChannels(),q(this.parallax.anchorPoint,this._anchorPoint),q(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case m.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==G.Ready&&(this.data.state=G.Idle),this.fadeState){case m.CROSS_FADE:q(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=m.SHOW;break;case m.FADE_IN:this._fadeState.value=m.SHOW;break;case m.FADE_OUT:this._fadeState.value=m.HIDE;break;case m.SHOW:case m.HIDE:break;default:dr(this.fadeState)}}_switchReadChannels(){this.data?.state===G.Ready&&(this._readChannels=1-this._readChannels,this.data.state=G.Fading)}get isFading(){return this.fadeState===m.FADE_OUT||this.fadeState===m.FADE_IN||this.fadeState===m.CROSS_FADE}}var m;(function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"})(m||(m={}));let oi=class{constructor(){this.anchorPoint=Ae(),this.radiusCurvatureCorrection=0,this.transform=H()}};const ni=Et(0,0,1),le=Fs(),ha=Ae(),ca=1.25,ua=.5,li=2e5;let da=class extends Fi{constructor(e,t){super(e,"samplerCube",$i.Bind,(i,r)=>i.bindTexture(e,t(r)))}};function Yo(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",ga).code.add(C`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new gt("radiusCurvatureCorrection",({clouds:r})=>r.parallax.radiusCurvatureCorrection)).code.add(C`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(C`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),ts(t),is(t);const i=Et(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",i),t.code.add(C`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${C.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${C.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${C.float(.2)} * pow(dirDotLight, ${C.float(10)}) * (1. - pow(sunsetTransition, ${C.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.uniforms.add(new zt("readChannelsRG",r=>r.clouds.readChannels===tt.RG),new da("cubeMap",r=>r.clouds.data?.cubeMap?.colorTexture??null)).code.add(C`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new qt("anchorPoint",r=>r.clouds.parallax.anchorPoint),new qt("anchorPointNew",r=>r.clouds.parallaxNew.anchorPoint),new Gt("rotationClouds",r=>r.clouds.parallax.transform),new Gt("rotationCloudsNew",r=>r.clouds.parallaxNew.transform),new gt("cloudsOpacity",r=>r.clouds.opacity),new gt("fadeFactor",r=>r.clouds.fadeFactor),new zt("crossFade",r=>r.clouds.fadeState===m.CROSS_FADE)).code.add(C`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const ga=(Be.radius+na)**2;var me;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(me||(me={}));let qi=class extends Fe{constructor(){super(...arguments),this.color=Et(1,1,1)}};function pa(){const e=new J;return e.include(At),e.fragment.uniforms.add(new W("tex",t=>t.texture),new _r("uColor",t=>t.color)),e.fragment.main.add(C`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const _a=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:qi,build:pa},Symbol.toStringTag,{value:"Module"}));let hi=class extends Fi{constructor(e,t){super(e,"ivec2",$i.Pass,(i,r,s)=>i.setUniform2iv(e,t(r,s)))}};class Gi extends Fe{}function ma(){const e=new J,{outputs:t,fragment:i}=e;return e.include(At),i.uniforms.add(new Di("textureInput",r=>r.input)),i.constants.add("outlineWidth","int",Math.ceil(it)),i.constants.add("cellSize","int",re),t.add("fragGrid","vec2"),i.main.add(C`ivec2 inputTextureSize = textureSize(textureInput, 0);
ivec2 cellBottomLeftCornerInput = ivec2(floor(gl_FragCoord.xy) * vec2(cellSize));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = uvec2( texelFetch(textureInput, coordMid, 0).rg * 255.0) & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
uvec2(texelFetch(textureInput,coord+ivec2(0,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,0),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(0,1),0).rg * 255.0) & uvec2(0x55u),
uvec2(texelFetch(textureInput,coord+ivec2(1,1),0).rg * 255.0) & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = vec2(outputValue) / 255.0;`),e}const re=32,it=9,ji=.4,fa=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Gi,blurSize:ji,build:ma,gridCellPixelSize:re,outlineSize:it},Symbol.toStringTag,{value:"Module"}));function ot(e){const{vertex:t}=e;t.uniforms.add(new W("coverageTexture",i=>i.coverageTexture),new hi("highlightRenderCellCount",i=>V(ci,i.horizontalCellCount,i.verticalCellCount)),new hi("highlightTextureResolution",({highlightTexture:i})=>V(ci,i.descriptor.width,i.descriptor.height)),new st("highlightLevel",i=>i.highlightLevel)).constants.add("cellSize","int",re),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(C`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`).main.add(C`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = uvec2(texelFetch(coverageTexture, cellPos, 0).rg * 255.0);
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const ci=x();function va(){const e=new J;e.include(ot);const{fragment:t}=e;return t.uniforms.add(new W("highlightTexture",i=>i.highlightTexture),new W("highlightOptionsTexture",i=>i.highlightOptionsTexture),new Ze("pixelRatio",i=>i.pixelRatio),new Ze("occludedIntensityFactor",i=>i.occludedFactor),new mr("maxHighlightLevel",i=>i.highlights.length-1)),t.constants.add("pixelSampleScale","float",1),e.include(Ft),t.code.add(C`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),t.main.add(C`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),e}const xa=Object.freeze(Object.defineProperty({__proto__:null,build:va},Symbol.toStringTag,{value:"Module"}));let ui=class extends X{constructor(e,t){super(e,t,new K(xa,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(i=>i.H)))}initializePipeline(){return B({blending:Lt,colorWrite:k})}},di=class extends X{constructor(e,t){super(e,t,new K(fa,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(i=>i.a)))}initializePipeline(){return B({colorWrite:k})}},ya=class extends Fe{constructor(){super(...arguments),this.occludedFactor=Ms,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function wa(){const e=new J;e.include(ot),e.include(Ft);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new W("highlightTexture",i=>i.highlightTexture),new st("highlightLevel",i=>i.highlightLevel)),t.main.add(C`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const Ca=Object.freeze(Object.defineProperty({__proto__:null,build:wa},Symbol.toStringTag,{value:"Module"}));let gi=class extends X{constructor(e,t){super(e,t,new K(Ca,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(i=>i.b)))}initializePipeline(){return B({colorWrite:k})}};function ba(){const e=new J;e.include(ot);const{fragment:t}=e;return t.uniforms.add(new W("blurInput",i=>i.singleHighlightBlurTexture),new Ei("blurSize",i=>i.blurSize),new W("highlightTexture",i=>i.highlightTexture),new W("highlightOptionsTexture",i=>i.highlightOptionsTexture),new st("highlightLevel",i=>i.highlightLevel),new Ze("occludedIntensityFactor",i=>i.occludedFactor)),t.constants.add("inner","float",1-(it-ji)/it),e.include(Ft),t.main.add(C`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const Ta=Object.freeze(Object.defineProperty({__proto__:null,build:ba},Symbol.toStringTag,{value:"Module"}));let pi=class extends X{constructor(e,t){super(e,t,new K(Ta,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(i=>i.S)))}initializePipeline(){return B({blending:Lt,colorWrite:k})}};class Bi extends Fe{constructor(){super(...arguments),this.blurSize=x()}}function Oa(){const e=new J;return e.include(ot),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.uniforms.add(new Ei("blurSize",t=>t.blurSize),new Di("blurInput",t=>t.blurInput)).main.add(C`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),e}const Ra=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:Bi,build:Oa},Symbol.toStringTag,{value:"Module"}));let _i=class extends X{constructor(e,t){super(e,t,new K(Ra,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(i=>i.c)))}initializePipeline(){return B({colorWrite:k})}};const Sa=[],Xo=[new Ye(y.POSITION,3,Ie.FLOAT,0,12)];new Ye(y.POSITION,2,Ie.FLOAT,0,8),new Ye(y.POSITION,2,Ie.FLOAT,0,16),new Ye(y.UV0,2,Ie.FLOAT,8,16);let qe=class extends Ir{constructor(){super(...arguments),this.produces=ct.HIGHLIGHTS,this.consumes={required:[ct.HIGHLIGHTS,"highlights"]},this._useMultipleHighlights=!1,this._downsampleDrawParameters=new Gi,this._passParameters=new ya,this._singleHighlightBlurDrawParameters=new Bi,this._grid=new Ia}initialize(){this.addHandles([pe(()=>this._updateOptionsTexture(),()=>{},wt)])}destroy(){this._grid.coverage=Pe(this._grid.coverage),this._grid.vao=Ke(this._grid.vao),this._passParameters.highlightOptionsTexture=Pe(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new zi(16,2);e.internalFormat=bs.RGBA,e.samplingMode=Vi.NEAREST,this._passParameters.highlightOptionsTexture=new fe(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(Pa(this.view.state.highlights)),this.requestRender(Re.UPDATE)}precompile(){this.techniques.precompile(di),this._useMultipleHighlights?this.techniques.precompile(ui):(this.techniques.precompile(gi),this.techniques.precompile(_i),this.techniques.precompile(pi))}render(e){const t=e.find(({name:f})=>f===ct.HIGHLIGHTS),{techniques:i,bindParameters:r,_passParameters:s,renderingContext:a}=this;if(!r.decorations)return t;const o=i.get(di);if(!o.compiled)return this.requestRender(Re.UPDATE),t;const n=e.find(({name:f})=>f==="highlights").getTexture(),l=()=>{this._gridUpdateResources(n);const f=this._gridComputeCoverage(o,n,r),{horizontalCellCount:p,verticalCellCount:S}=f;return s.horizontalCellCount=p,s.verticalCellCount=S,s.coverageTexture=f.coverage?.getTexture(),f},d=f=>{const p=f.verticalCellCount*f.horizontalCellCount;a.bindVAO(f.vao),a.drawElementsInstanced(Ts.TRIANGLES,6,Ie.UNSIGNED_BYTE,0,p)},{camera:g}=r,_=()=>{a.bindFramebuffer(t.fbo),a.setViewport4fv(g.fullViewport)};return this._useMultipleHighlights?this._renderMultiple(n,l,d,_):this._renderSingle(n,l,d,_),s.highlightTexture=null,s.coverageTexture=null,t}_renderMultiple(e,t,i,r){const{techniques:s,bindParameters:a,_passParameters:o,renderingContext:n}=this,l=s.get(ui);if(!l.compiled)return void this.requestRender(Re.UPDATE);const d=t();o.highlightTexture=e,o.pixelRatio=a.camera.pixelRatio,n.bindTechnique(l,a,o),r(),i(d)}_renderSingle(e,t,i,r){const{fboCache:s,techniques:a,bindParameters:o,_passParameters:n,renderingContext:l}=this,d=a.get(gi),g=a.get(_i),_=a.get(pi);if(!_.compiled||!g.compiled||!d.compiled)return void this.requestRender(Re.UPDATE);const f=t(),{width:p,height:S}=e.descriptor;n.highlightTexture=e;const{camera:ve}=o,{fullWidth:xe,fullHeight:nt,pixelRatio:Le}=ve,ye=Math.ceil(xe/Le),we=Math.ceil(nt/Le),{_singleHighlightBlurDrawParameters:v}=this,I=this.view._stage.renderView.renderer,{highlights:Nt}=o;for(let Ne=0;Ne<Nt.length;++Ne){const{name:Xi}=Nt[Ne];if(!I.hasHighlightOptions(Xi))continue;n.highlightLevel=Ne,l.setClearColor(0,0,0,0);const lt=s.acquire(p,S,"single highlight",$.RG);l.bindFramebuffer(lt.fbo),l.setViewport(0,0,p,S),l.clear(se.COLOR),l.bindTechnique(d,o,n),i(f),v.blurInput=lt.getTexture(),V(v.blurSize,1/ye,0);const He=s.acquire(ye,we,"single highlight blur h",$.RG);l.unbindTexture(He.fbo?.colorTexture),l.bindFramebuffer(He.fbo),l.setViewport(0,0,ye,we),l.clear(se.COLOR),l.bindTechnique(g,o,n,v),i(f),lt.release(),V(v.blurSize,0,1/we),n.singleHighlightBlurTexture=He.getTexture(),r(),l.bindTechnique(_,o,n,v),i(f),He.release()}}_gridUpdateResources(e){const t=this._grid,{width:i,height:r}=e.descriptor;if(t.horizontalCellCount=Math.ceil(i/re),t.verticalCellCount=Math.ceil(r/re),t.vao)return;const s=this.renderingContext,a=Zt.createIndex(s,Qt.STATIC_DRAW,Aa);t.vao=new Es(s,Pr,new Map([["geometry",Sa]]),new Map([["geometry",Zt.createVertex(s,Qt.STATIC_DRAW)]]),a)}_gridComputeCoverage(e,t,i){const r=this.renderingContext,s=this._grid,a=t.descriptor,o=Math.ceil(a.width/re),n=Math.ceil(a.height/re);this._downsampleDrawParameters.input=t,s.coverage?.release();const l=this.fboCache.acquire(o,n,"highlight coverage",$.RG);return s.coverage=l,r.bindFramebuffer(l.fbo),r.bindTechnique(e,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,n),r.screen.draw(),s}get test(){}};c([w()],qe.prototype,"produces",void 0),c([w()],qe.prototype,"consumes",void 0),qe=c([Y("esri.views.3d.webgl-engine.effects.highlight.Highlight")],qe);class Ia{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}function Pa(e){const t=new Uint8Array(128);let i=0;for(const r of e){const s=4*i,a=4*i+64;++i;const{color:o}=r,n=r.haloColor??o;t[s+0]=o.r,t[s+1]=o.g,t[s+2]=o.b,t[s+3]=r.fillOpacity*o.a*255,t[a+0]=n.r,t[a+1]=n.g,t[a+2]=n.b,t[a+3]=r.haloOpacity*n.a*255}return t}let Da=0;function Ea(e){let t=0;for(const r of e){const{name:s}=r;t+=s.length;const{color:a,fillOpacity:o,haloColor:n,haloOpacity:l}=r;t+=a.r+a.g+a.b+a.a+o,t+=n?n.r+n.g+n.b+n.a+l:0}const i=e.at(0);if(i){const{shadowOpacity:r,shadowDifference:s,shadowColor:a}=i;t+=r+s+a.r+a.g+a.b+a.a}return Da+++(t>=0?0:1)}const Aa=new Uint8Array([0,1,2,2,1,3]);function Fa(e,t,i,r,s,a=0){const o=r.highlights,n=o.length>1?t.acquire(i.width,i.height,"highlight mix",$.RG):null;if(n){const d=e.getBoundFramebufferObject();e.bindFramebuffer(n.fbo),e.clearFramebuffer(Si),e.bindFramebuffer(d)}const l=n?.getTexture();r.highlightMixTexture=l,V(r.highlightMixOrigin,a,0),o.forEach((d,g)=>{g>0&&(e.bindTexture(l,fe.TEXTURE_UNIT_FOR_UPDATES),e.gl.copyTexSubImage2D(Ui.TEXTURE_2D,0,0,0,a,0,i.width,i.height),e.bindTexture(null,fe.TEXTURE_UNIT_FOR_UPDATES)),e.clear(se.DEPTH),r.highlightLevel=g,s()}),r.highlightLevel=null,r.highlightMixTexture=null,n?.release()}let Ma=class{constructor(e,t,i,r){this._textures=e,this._techniques=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new Ls}dispose(){this._textures.destroy()}acquire(e,t,i){if(this._ownMaterial(e),!e.produces.get(t)?.(i))return null;let r=this._id2glMaterialRef.get(i,e.id);if(r==null){const s=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:i});r=new La(s),this._id2glMaterialRef.set(i,e.id,r)}return r.ref(),r.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);i!=null&&(i.unref(),i.referenced||(Ke(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&nr.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},La=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,_e(this._refCnt>=0)}get referenced(){return this._refCnt>0}};var rt;(function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"})(rt||(rt={}));let Na=class{constructor(e){this.shadowMap=e,this.slot=M.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Je.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new at,this._inverseViewport=x(),this._oldLighting=new dt,this._newLighting=new dt,this._fadedLighting=new dt,this._lighting=this._newLighting,this.ssr=new Ha,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=x(),this.highlightMixTexture=null,this.hudRenderStyle=Ns.Occluded,this.hudOccludedFragmentOpacity=1,this.clouds=new la,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,i,r){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=i,this._newLighting.set(e),r===rt.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},Ha=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=H()}},Va=class{constructor(e,t){this.rctx=e,this.lastFrameCamera=new at,this.output=D.Color,this.renderOccludedMask=Xe,this.bind=new Na(t),this.bind.alignPixelEnabled=!0}};const Xe=Qe.Occlude|Qe.OccludeAndTransparent|Qe.OccludeAndTransparentStencil;let Se=class extends at{constructor(){super(...arguments),this._projectionMatrix=H()}get projectionMatrix(){return this._projectionMatrix}};c([w()],Se.prototype,"_projectionMatrix",void 0),c([w({readOnly:!0})],Se.prototype,"projectionMatrix",null),Se=c([Y("esri.views.3d.webgl-engine.lib.CascadeCamera")],Se);var It;(function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"})(It||(It={}));class Ge{constructor(){this.camera=new Se,this.lightMat=H()}}class Ua{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Wa{constructor(t,i){this._fbos=t,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Ua,this._projectionView=H(),this._projectionViewInverse=H(),this._modelViewLight=H(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Dt(),this._cascades=[new Ge,new Ge,new Ge,new Ge],this._lastOrigin=null,this._maxTextureWidth=Math.min(lr("esri-mobile")?4096:16384,t.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Jt(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Pe(this._handle),this._discardSnapshots()}set maxCascades(t){this.settings.maxNumCascadesHighQuality=Pi(Math.floor(t),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(t){this._enabled=t,t||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let t=0;t<this._numCascades;++t)vt[t]=this._cascades[t];return vt.length=this._numCascades,vt}start(t,i,r,s,a){_e(this.enabled);const{near:o,far:n}=Ba(r);this._computeCascadeDistances(o,n,s),this._textureHeight=this._computeTextureHeight(t,a,s),this._setupMatrices(t,i);const{viewMatrix:l,projectionMatrix:d}=t;for(let g=0;g<this._numCascades;++g)this._constructCascade(g,d,l,i);this._lastOrigin=null,this.clear()}finish(){_e(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(t){if(!this._lastOrigin||!cs(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||Ae(),q(this._lastOrigin,t);for(let i=0;i<this._numCascades;++i){jt(wi,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)Ci[16*i+r]=wi[r]}}return Ci}moveSnapshot(t){_e(this.enabled),this._handle?.detachDepth(),this._snapshots[t]?.release(),this._snapshots[t]=this._handle,this._handle=null,this.clear()}copySnapshot(t){const i=this._handle?.getTexture()?.descriptor;if(!this.enabled||!i)return;this._snapshots[t]?.release();const{width:r,height:s}=i,a=t===It.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[t]=this._fbos.acquire(r,s,a,$.RGBA4);const o=this._fbos.rctx;this._bindFbo();const n=o.bindTexture(this._snapshots[t]?.getTexture(),fe.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(Ui.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(n,fe.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(t){return this.enabled?this._snapshots[t]?.getTexture():null}clear(){const t=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),t.setClearColor(1,1,1,1),t.clear(se.COLOR|se.DEPTH)}_computeTextureHeight(t,i,r){const s=Math.min(window.devicePixelRatio,i)/t.pixelRatio,a=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=Hr(Math.floor(Math.max(t.fullWidth,t.fullHeight)*s*a)),n=Math.min(this._maxTextureWidth,this._numCascades*o);return Vr(n/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",$.RGBA4)),this._handle?.acquireDepth(Ur.DEPTH16_BUFFER)}_discardSnapshot(t){this._snapshots[t]=Pe(this._snapshots[t])}_discardSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(t,i,r,s){const a=this._cascades[t],o=-this._cascadeDistances[t],n=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),d=(i[10]*n+i[14])/Math.abs(i[11]*n+i[15]);_e(l<d);for(let p=0;p<8;++p){Jt(mi,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:d,1);const S=N[p];Vs(S,mi,this._projectionViewInverse),S[0]/=S[3],S[1]/=S[3],S[2]/=S[3]}us(ft,N[0]),a.camera.viewMatrix=jt($a,this._modelViewLight,ft);for(let p=0;p<8;++p)Ni(N[p],N[p],a.camera.viewMatrix);let g=N[0][2],_=N[0][2];for(let p=1;p<8;++p)g=Math.min(g,N[p][2]),_=Math.max(_,N[p][2]);g-=200,_+=200,a.camera.near=-_,a.camera.far=-g,ja(r,s,g,_,a.camera),Ct(a.lightMat,a.camera.projectionMatrix,a.camera.viewMatrix);const f=this._textureHeight;a.camera.viewport=[t*f,0,f,f]}_setupMatrices(t,i){Ct(this._projectionView,t.projectionMatrix,t.viewMatrix),ns(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Mi.Global?t.eye:Li(ft,0,0,1);ls(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(t,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(ss(i/t,4)),s);const a=(i-t)/this._numCascades,o=(i/t)**(1/this._numCascades);let n=t,l=t;for(let d=0;d<this._numCascades+1;++d)this._cascadeDistances[d]=hr(n,l,this.settings.splitSchemeLambda),n*=o,l+=a}get test(){}}const $a=H(),mi=Dt(),N=[];for(let e=0;e<8;++e)N.push(Dt());const fi=x(),vi=x(),za=x(),xi=x(),yi=x(),ft=Ae(),vt=[],wi=H(),Ci=ie.concat(ie,ie,ie,ie),L=x(),he=x(),te=[x(),x(),x(),x()],T=x(),xt=x(),z=x(),Oe=x(),ce=x(),ue=x(),je=x();function qa(e,t,i,r,s,a,o,n){V(L,0,0);for(let v=0;v<4;++v)ee(L,L,e[v]);de(L,L,.25),V(he,0,0);for(let v=4;v<8;++v)ee(he,he,e[v]);de(he,he,.25),Ce(te[0],e[4],e[5],.5),Ce(te[1],e[5],e[6],.5),Ce(te[2],e[6],e[7],.5),Ce(te[3],e[7],e[4],.5);let l=0,d=Ht(te[0],L);for(let v=1;v<4;++v){const I=Ht(te[v],L);I<d&&(d=I,l=v)}ge(T,te[l],e[l+4]);const g=T[0];let _,f;T[0]=-T[1],T[1]=g,ge(xt,he,L),R(xt,T)<0&&Zi(T,T),Ce(T,T,xt,i),Vt(T,T),_=f=R(ge(z,e[0],L),T);for(let v=1;v<8;++v){const I=R(ge(z,e[v],L),T);I<_?_=I:I>f&&(f=I)}Ji(r,L),de(z,T,_-t),ee(r,r,z);let p=-1,S=1,ve=0,xe=0;for(let v=0;v<8;++v){ge(Oe,e[v],r),Vt(Oe,Oe);const I=T[0]*Oe[1]-T[1]*Oe[0];I>0?I>p&&(p=I,ve=v):I<S&&(S=I,xe=v)}ae(p>0,"leftArea"),ae(S<0,"rightArea"),de(ce,T,_),ee(ce,ce,L),de(ue,T,f),ee(ue,ue,L),je[0]=-T[1],je[1]=T[0];const nt=Ve(r,e[xe],ue,ee(z,ue,je),1,s),Le=Ve(r,e[ve],ue,z,1,a),ye=Ve(r,e[ve],ce,ee(z,ce,je),1,o),we=Ve(r,e[xe],ce,z,1,n);ae(nt,"rayRay"),ae(Le,"rayRay"),ae(ye,"rayRay"),ae(we,"rayRay")}function u(e,t){return 3*t+e}const bi=x();function E(e,t){return V(bi,e[t],e[t+3]),bi}const P=x(),h=Hs();function Ga(e,t,i,r,s){ge(P,i,r),de(P,P,.5),h[0]=P[0],h[1]=P[1],h[2]=0,h[3]=P[1],h[4]=-P[0],h[5]=0,h[6]=P[0]*P[0]+P[1]*P[1],h[7]=P[0]*P[1]-P[1]*P[0],h[8]=1,h[u(0,2)]=-R(E(h,0),e),h[u(1,2)]=-R(E(h,1),e);let a=R(E(h,0),i)+h[u(0,2)],o=R(E(h,1),i)+h[u(1,2)],n=R(E(h,0),r)+h[u(0,2)],l=R(E(h,1),r)+h[u(1,2)];a=-(a+n)/(o+l),h[u(0,0)]+=h[u(1,0)]*a,h[u(0,1)]+=h[u(1,1)]*a,h[u(0,2)]+=h[u(1,2)]*a,a=1/(R(E(h,0),i)+h[u(0,2)]),o=1/(R(E(h,1),i)+h[u(1,2)]),h[u(0,0)]*=a,h[u(0,1)]*=a,h[u(0,2)]*=a,h[u(1,0)]*=o,h[u(1,1)]*=o,h[u(1,2)]*=o,h[u(2,0)]=h[u(1,0)],h[u(2,1)]=h[u(1,1)],h[u(2,2)]=h[u(1,2)],h[u(1,2)]+=1,a=R(E(h,1),t)+h[u(1,2)],o=R(E(h,2),t)+h[u(2,2)],n=R(E(h,1),i)+h[u(1,2)],l=R(E(h,2),i)+h[u(2,2)],a=-.5*(a/o+n/l),h[u(1,0)]+=h[u(2,0)]*a,h[u(1,1)]+=h[u(2,1)]*a,h[u(1,2)]+=h[u(2,2)]*a,a=R(E(h,1),t)+h[u(1,2)],o=R(E(h,2),t)+h[u(2,2)],n=-o/a,h[u(1,0)]*=n,h[u(1,1)]*=n,h[u(1,2)]*=n,s[0]=h[0],s[1]=h[1],s[2]=0,s[3]=h[2],s[4]=h[3],s[5]=h[4],s[6]=0,s[7]=h[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=h[6],s[13]=h[7],s[14]=0,s[15]=h[8]}function ja(e,t,i,r,s){const a=1/N[0][3],o=1/N[4][3];_e(a<o);let n=a+Math.sqrt(a*o);const l=Math.sin(cr(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));n/=l,qa(N,n,l,fi,vi,za,xi,yi),Ga(fi,vi,xi,yi,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function Ba(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}class Ti extends X{constructor(t,i){super(t,i,new K(_a,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(r=>r.T)))}initializePipeline(t){return t.hasAlpha?B({blending:Lt,colorWrite:k}):B({colorWrite:k})}}class ki extends fr{constructor(){super(...arguments),this.hasAlpha=!1}}c([A()],ki.prototype,"hasAlpha",void 0);let Qi=class extends Fe{constructor(){super(...arguments),this.overlayIndex=j.INNER,this.opacity=1}};function ka(){const e=new J;return e.include(At),e.fragment.uniforms.add(new W("tex",t=>t.texture)),e.fragment.uniforms.add(new st("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new Ze("opacity",t=>t.opacity)),e.fragment.main.add(C`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const Qa=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Qi,build:ka},Symbol.toStringTag,{value:"Module"}));class Oi extends X{constructor(t,i){super(t,i,new K(Qa,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(r=>r.O)))}}let U=class extends As{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Qi,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new tr,this._passParameters=new qi,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new at,this.events=new ir,this.longitudeCyclical=null,this.produces=new Map([[M.DRAPED_MATERIAL,t=>t!==D.Highlight||this.hasHighlights],[M.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,t=e._stage,i=t.renderer.fboCache,{waterTextures:r,textures:s}=t.renderView;this._renderContext=new Va(this._rctx,new Wa(i,e.state.viewingMode)),this.addHandles([pe(()=>r.updating,()=>this.events.emit("content-changed"),Ut),pe(()=>this.spatialReference,n=>this._localOriginFactory=new Rs(n),Ut),rr(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),pe(()=>Ea(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,wt),pe(()=>e.state.highlights,n=>{this._bindParameters.highlights=n,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap,this._updateHighlights()},wt),e.resourceController.scheduler.registerTask(Us.STAGE,this)]),this._materials=new Ma(s,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const{_bindParameters:a,_camera:o}=this;o.near=1,o.far=1e4,o.relativeElevation=null,a.slot=M.DRAPED_MATERIAL,a.mainDepth=null,a.camera=o,a.oitPass=Je.NONE,a.updateLighting([new Dr(sr())],0,0,rt.Immediate)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Ke(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view._stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(Oi)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||be(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const t of this._renderers.values()){const i=t.getMaterialRenderer(e);if(i)return i}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}_updateHighlights(){const e=this._view.state;this._renderers.forEach(t=>t.updateHighlights(e.highlightOrderMap))}createDrapeSourceRenderer(e,t,i){this._renderers.get(e)?.destroy();const r=new t({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,r),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(pe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),r}removeDrapeSourceRenderer(e){if(e==null)return;const t=this._renderers.get(e);t!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&ht(e,t=>t.drapeTargetType===Ps.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=ht(e,t=>t.drapeSourceType===Ue.Features),this._hasDrapedRasterSource=ht(e,t=>t.drapeSourceType===Ue.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,i=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new aa(this._stage.renderer.fboCache),this._overlays=[new si,new si]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=Ke(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===b.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(b.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._renderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges(this._view.state.highlightOrderMap)&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=be(this._renderers,r=>r.hasHighlights),this.notifyChange("rendersOccludedDraped"))}hasHighlightOptions(e){return be(this._renderers,t=>t.hasHighlightOptions(e))}processSyncDrapeSources(){this._processDrapeSources(Ws,e=>e.updatePolicy===Ss.SYNC)}get isEmpty(){return!ut.OVERLAY_DRAW_DEBUG_TEXTURE&&!be(this._renderers,e=>!e.isEmpty)}get hasWater(){const e=be(this._renderers,t=>t.hasWater);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=yt,++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:i})=>i.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(ut.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==b.Occluded&&e!==b.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:i})=>i.precompile(this._renderContext));return--this._techniques.precompiling,t}get mode(){return this.isEmpty?me.Disabled:this.hasWater&&this.renders(b.WaterNormal)?me.EnabledWithWater:this._renderTargets?.getTexture(b.Color)?me.Enabled:me.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach(i=>t=i.updateAnimation(e)||t),t&&this.parent.requestRender(Re.BACKGROUND),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const t of this._renderTargets.targets){if(t.content===b.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=t.output;this._renderContext.output=i,this._bindParameters.slot=i===D.Normal?M.DRAPED_WATER:M.DRAPED_MATERIAL,t.content===b.Occluded&&(this._renderContext.renderOccludedMask=yt),this._sortedRenderers.forAll(({drapeSource:r,renderer:s})=>{t.content===b.ColorNoRasterImage&&r.drapeSourceType===Ue.RasterImage||s.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=Xe}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const t of this._overlays)this.longitudeCyclical?t.setupGeometryViewsCyclical(this.longitudeCyclical):t.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const t of this._renderTargets.targets){if(t.content===b.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=this._drawTarget(j.INNER,t),r=this._drawTarget(j.OUTER,t);(i||r)&&t.fbo.generateMipMap()}}}_drawTarget(e,t){const i=this._overlays[e],r=i.canvasGeometries;if(r.numViews===0)return!1;const s=this._view.state.contentPixelRatio;this._screenToWorldRatio=s*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===D.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const{_rctx:o,_camera:n,_renderContext:l,_bindParameters:d}=this;if(n.pixelRatio=i.pixelRatio*s,l.output=a,d.screenToWorldRatio=this._screenToWorldRatio,d.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,d.slot=a===D.Normal?M.DRAPED_WATER:M.DRAPED_MATERIAL,t.content===b.Occluded&&(l.renderOccludedMask=yt),!this.renders(t.content))return l.renderOccludedMask=Xe,!1;const{resolution:g}=i,_=e===j.INNER?0:g;if(o.setViewport(_,0,g,g),this._bindTargetFBO(t),e===j.INNER&&(o.setClearColor(0,0,0,0),o.clear(se.COLOR)),ut.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==b.Occluded&&t.content!==b.Highlight){this._techniques.precompile(Ti,Pt);const f=this._techniques.get(Ti,Pt);for(let p=0;p<r.numViews;p++)this._setViewParameters(r.extents[p],i),this._ensureDebugPatternResources(i.resolution,Xa[e]),o.bindTechnique(f,d,this._passParameters),o.screen.draw()}if(t.output===D.Highlight){const{fboCache:f}=this._stage.renderer,p=this._resolution;this._bindTargetFBO(t),Fa(o,f,{width:p,height:p},d,()=>this._renderAllGeometry(e,t),_)}else this._renderAllGeometry(e,t);return o.bindFramebuffer(null),l.renderOccludedMask=Xe,!0}_renderAllGeometry(e,t){const i=this._overlays[e],r=i.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:s,renderer:a})=>{if(t.content===b.ColorNoRasterImage&&s.drapeSourceType===Ue.RasterImage)return;const{fullOpacity:o}=s,n=o!=null&&o<1&&t.output===D.Color&&this._bindTemporaryFBO();for(let l=0;l<r.numViews;l++)this._setViewParameters(r.extents[l],i),a.render(this._renderContext);if(n){this._bindTargetFBO(t),this._overlayParameters.texture=n.getTexture(),this._overlayParameters.opacity=o,this._overlayParameters.overlayIndex=e;const l=this._techniques.get(Oi);this._rctx.bindTechnique(l,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),n.release()}})}_bindTargetFBO(e){const t=this._resolution,i=2*t;e.fbo.bind(this._rctx,i,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,i=this._stage.renderer.fboCache,r=i.acquire(t,e,"overlay tmp");return i.rctx.bindFramebuffer(r.fbo),i.rctx.clear(se.COLOR),r}get _resolution(){return this._overlays?.[j.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:a}of this._sortedRenderers)s=a.intersect?.(e,t,i,r,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers,t=e.length;this._renderers.forEach((i,r)=>{const s=e.indexOf(r.layer),a=s>=0,o=r.renderGroup??(a?Yt.MapLayer:Yt.ViewLayer),n=t*o+(a?s:0);this._sortedRenderers.push(new Ya(r,i,n))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,t){const i=this._camera;i.viewport=[0,0,t.resolution,t.resolution],as(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),os(i.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,t){if(Li(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let r=0;for(let a=0;a<e;a++)for(let o=0;o<e;o++){const n=Math.floor(o/10),l=Math.floor(a/10);n<2||l<2||10*n>e-20||10*l>e-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&n&&1&l?1&o^1&a?0:255:1&n^1&l?0:128)}const s=new zi(e);s.samplingMode=Vi.NEAREST,this._passParameters.texture=new fe(this._rctx,s,i)}get test(){}};c([w()],U.prototype,"hasHighlights",void 0),c([w()],U.prototype,"_sortedDrapeSourceRenderersDirty",void 0),c([w({constructOnly:!0})],U.prototype,"parent",void 0),c([w({readOnly:!0})],U.prototype,"_techniques",null),c([w({type:Boolean,readOnly:!0})],U.prototype,"updating",null),c([w()],U.prototype,"isEmpty",null),c([w({readOnly:!0})],U.prototype,"rendersOccludedDraped",null),U=c([Y("esri.views.3d.terrain.OverlayRenderer")],U);class Ya{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Xa=[[1,.5,.5],[.5,.5,1]],Ka=-2,yt=Qe.OccludeAndTransparent,Pt=new ki;Pt.hasAlpha=!0;class Ko{constructor(t,i={}){this.geometry=t,this.screenToWorldRatio=1,this._transformation=H(),this._shaderTransformation=null,this._boundingSphere=null,this.id=ur(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(t){hs(this._transformation,t),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(t){t==null?this._shaderTransformation=null:(this._shaderTransformation??=H(),Ct(this._shaderTransformation,t,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??=fs(),Ni(vs(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*ys(this.shaderTransformation)),this._boundingSphere):xs}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(t){this.geometry.foreachHighlightOptions(t)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}}function Za(e){const t=new J,{vertex:i,fragment:r,attributes:s,varyings:a}=t,{vvColor:o,hasVertexColors:n}=e;return vr(i,e),t.include(xr,e),t.include(yr,e),t.include(wr,e),t.include(Cr,e),r.include(br,e),t.include(Tr,e),t.include(Or,e),s.add(y.POSITION,"vec3"),o&&s.add(y.COLORFEATUREATTRIBUTE,"float"),n||a.add("vColor","vec4"),a.add("vpos","vec3"),i.uniforms.add(new Rr("uColor",l=>l.color)),i.main.add(C`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${n?"vColor *= uColor;":o?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),r.include(Sr),r.main.add(C`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos);`),t}const Ja=Object.freeze(Object.defineProperty({__proto__:null,build:Za},Symbol.toStringTag,{value:"Module"}));class eo extends X{constructor(t,i){super(t,i,new K(Ja,()=>Q(()=>import("./editingTools-CWx0-1A2-PBrCZS45.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127]),import.meta.url).then(r=>r.C)))}_createPipeline(t,i){const{oitPass:r,output:s,transparent:a,cullFace:o,draped:n,hasOccludees:l,polygonOffset:d,enableOffset:g}=t,_=r===Je.NONE,f=r===Je.FrontFace;return B({blending:Hi(s)&&a?kr(r):null,culling:Cs(o),depthTest:n?null:{func:Qr(r)},depthWrite:Yr(t),drawBuffers:s===D.Depth?{buffers:[Os.NONE]}:Xr(r,s),colorWrite:k,stencilWrite:l?Kr:null,stencilTest:l?i?Zr:Jr:null,polygonOffset:_||f?d?to:null:es(g)})}initializePipeline(t){return this._occludeePipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}const to={factor:1,units:1};let F=class extends Er{constructor(){super(...arguments),this.cullFace=Mt.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=Ar.None,this.emissionSource=Fr.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}};c([A({count:Mt.COUNT})],F.prototype,"cullFace",void 0),c([A()],F.prototype,"hasVertexColors",void 0),c([A()],F.prototype,"transparent",void 0),c([A()],F.prototype,"discardInvisibleFragments",void 0),c([A()],F.prototype,"polygonOffset",void 0),c([A()],F.prototype,"enableOffset",void 0),c([A()],F.prototype,"writeDepth",void 0),c([A()],F.prototype,"hasOccludees",void 0),c([A()],F.prototype,"terrainDepthTest",void 0),c([A()],F.prototype,"cullAboveTerrain",void 0),c([A()],F.prototype,"objectAndLayerIdColorInstanced",void 0),c([A()],F.prototype,"vvColor",void 0),c([A()],F.prototype,"draped",void 0);class Zo extends Zs{constructor(t){super(t,ro),this._configuration=new F,this.supportsEdges=!0,this.produces=new Map([[M.OPAQUE_MATERIAL,i=>this._isOpaqueMaterialPass(i)],[M.OPAQUE_MATERIAL_WITHOUT_NORMALS,i=>this._isOpaqueNoSSAODepthPass(i)],[M.TRANSPARENT_MATERIAL,i=>pt(i)&&this._transparent&&this.parameters.writeDepth],[M.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,i=>kt(i)&&this._transparent&&this.parameters.writeDepth],[M.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>pt(i)&&this._transparent&&!this.parameters.writeDepth],[M.DRAPED_MATERIAL,i=>ws(i)]])}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(t)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=i.hasOccludees,this._configuration.oitPass=i.oitPass,this._configuration.enableOffset=i.camera.relativeElevation<Wr,this._configuration.terrainDepthTest=i.terrainDepthTest&&Hi(t),this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=$r}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(t){return this._isOpaqueMaterialPass(t)||this._isOpaqueNoSSAODepthPass(t)}_isOpaqueMaterialPass(t){return t===D.Highlight||pt(t)&&!this._transparent}_isOpaqueNoSSAODepthPass(t){return kt(t)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(t){return new io(t)}createBufferWriter(){const t=Me().vec3f(y.POSITION);return Ai()&&t.vec4u8(y.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?t.f32(y.COLORFEATUREATTRIBUTE):t.vec4u8(y.COLOR),new zr(t)}}class io extends qr{beginSlot(t){return this.getTechnique(eo,t)}}class ro extends Gr{constructor(){super(...arguments),this.color=Si,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Mt.None,this.draped=!1,this.discardInvisibleFragments=!1}}function Jo(e,t,i,r){const s=e.type==="polygon"?et.CCW_IS_HOLE:et.NONE,a=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:n}=Wi(a,!!e.hasZ,s,e.spatialReference),l=Ii(o.length),d=Ds(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),g=d!=null;return{lines:g?Yi(n,o,l):[],projectionSuccess:g,sampledElevation:d}}function en(e,t){const i=e.type==="polygon"?et.CCW_IS_HOLE:et.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:a}=Wi(r,!1,i),o=pr(s,e.spatialReference,0,s,t,0);for(let n=2;n<s.length;n+=3)s[n]=Ka;return{lines:o?Yi(a,s):[],projectionSuccess:o}}function Yi(e,t,i=null){const r=new Array;for(const{index:s,count:a}of e){if(a<=1)continue;const o=3*s,n=3*a;r.push({position:$t(t,3*s,3*a),mapPositions:i!=null?$t(i,o,n):void 0})}return r}var Ri;(function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Ri||(Ri={}));export{zo as $,Gi as A,qi as E,ji as F,Yo as I,re as K,va as L,Bi as M,ti as T,Qi as U,ba as V,wa as W,Jo as _,ma as a,it as b,pa as c,Ri as d,ka as e,en as f,Zo as g,ei as h,Za as i,Zs as j,Go as k,Ko as l,ko as m,Xo as n,Qo as o,jo as p,Oa as q,Ka as r,qo as s,Bo as u};
